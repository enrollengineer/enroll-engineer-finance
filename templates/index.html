<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ENROLL ENGINEERING - Premium Financial Management Platform</title>

    <!-- Firebase Integration -->
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
        import { getAnalytics } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-analytics.js";
        // TODO: Add SDKs for Firebase products that you want to use
        // https://firebase.google.com/docs/web/setup#available-libraries
        import { getFirestore, collection, addDoc, getDocs, updateDoc, deleteDoc, doc, query, where, orderBy, runTransaction, getDoc } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";
        import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged, sendPasswordResetEmail } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-auth.js";
        import { getStorage, ref, uploadBytes, getDownloadURL } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-storage.js";

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
        const firebaseConfig = {
            apiKey: "AIzaSyDzNFfrnoBB9wlRug_cssJKk6alnDGkJuc",
            authDomain: "enroll-engineer.firebaseapp.com",
            projectId: "enroll-engineer",
            storageBucket: "enroll-engineer.firebasestorage.app",
            messagingSenderId: "1042439322185",
            appId: "1:1042439322185:web:dcafce2ec8b7d6997b9d98",
            measurementId: "G-5XJG8RT4FF"
        };

        // Initialize Firebase
        const app = initializeApp(firebaseConfig);
        const analytics = getAnalytics(app);
        
        // Initialize Firebase services
        const db = getFirestore(app);
        const auth = getAuth(app);
        const storage = getStorage(app);

        // Export to global window for access from other scripts
        window.firestoreDb = db;
        window.firebaseAuth = auth;
        window.firebaseStorage = storage;
        window.firebaseAnalytics = analytics;
        window.firestoreAddDoc = addDoc;
        window.firestoreGetDocs = getDocs;
        window.firestoreUpdateDoc = updateDoc;
        window.firestoreDeleteDoc = deleteDoc;
        window.firestoreCollection = collection;
        window.firestoreDoc = doc;
        window.firestoreQuery = query;
        window.firestoreWhere = where;
        window.firestoreOrderBy = orderBy;
        window.createUserWithEmailAndPassword = createUserWithEmailAndPassword;
        window.signInWithEmailAndPassword = signInWithEmailAndPassword;
        window.signOut = signOut;
        window.onAuthStateChanged = onAuthStateChanged;
        window.sendPasswordResetEmail = sendPasswordResetEmail;
        // Added for new features
        window.runTransaction = runTransaction;
        window.getDoc = getDoc;
        window.storageRef = ref;
        window.uploadBytes = uploadBytes;
        window.getDownloadURL = getDownloadURL;
        
        console.log("üî• Firebase initialized successfully with EnrollEngineer configuration");
        console.log("üìä Analytics enabled for project: enroll-engineer");
        console.log("üéÜ Project ID: enroll-engineer");
    </script>

    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap');

        * {
            font-family: 'Inter', sans-serif;
        }

        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }

        .gradient-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .gradient-gold {
            background: linear-gradient(135deg, #ffd89b 0%, #19547b 100%);
        }

        .glass-effect {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .animate-float {
            animation: float 6s ease-in-out infinite;
        }

        .animate-pulse-slow {
            animation: pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }

        @keyframes float {

            0%,
            100% {
                transform: translateY(0px);
            }

            50% {
                transform: translateY(-20px);
            }
        }

        .hover-scale {
            transition: transform 0.3s ease;
        }

        .hover-scale:hover {
            transform: scale(1.05);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }

        .notification-dot {
            animation: ping 2s cubic-bezier(0, 0, 0.2, 1) infinite;
        }

        .testimonial-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
        }

        .feature-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .nav-link {
            position: relative;
            transition: all 0.3s ease;
        }

        .nav-link::after {
            content: '';
            position: absolute;
            width: 0;
            height: 2px;
            bottom: -5px;
            left: 50%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            transition: all 0.3s ease;
            transform: translateX(-50%);
        }

        .nav-link:hover::after {
            width: 100%;
        }

        .dashboard-card {
            background: linear-gradient(145deg, #ffffff 0%, #f8fafc 100%);
            border: 1px solid rgba(0, 0, 0, 0.05);
            transition: all 0.3s ease;
        }

        .dashboard-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.15);
        }

        .metric-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .invoice-status-paid {
            background: linear-gradient(135deg, #4ade80 0%, #22c55e 100%);
        }

        .invoice-status-pending {
            background: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
        }

        .invoice-status-overdue {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
        }

        /* Invoice Template Styles */
        .invoice-template {
            background: white;
            border: 2px solid #000;
            font-family: Arial, sans-serif;
            font-size: 12px;
            line-height: 1.2;
        }

        .invoice-template table {
            width: 100%;
            border-collapse: collapse;
        }

        .invoice-template td,
        .invoice-template th {
            border: 1px solid #000;
            padding: 4px;
            text-align: left;
        }

        .invoice-header {
            text-align: center;
            font-weight: bold;
            font-size: 16px;
        }

        .company-details {
            text-align: center;
            font-size: 10px;
            line-height: 1.3;
        }

        /* Status Dropdown Styles */
        .status-dropdown {
            border: none;
            background: transparent;
            color: rgb(56, 55, 55);
            font-weight: 500;
            font-size: 12px;
            padding: 4px 8px;
            border-radius: 20px;
            cursor: pointer;
            outline: none;
        }

        .status-dropdown option {
            color: rgb(235, 227, 227);
            background: rgb(41, 41, 41);
            padding: 5px;
        }

        @media print {
            body * {
                visibility: hidden;
            }

            #invoicePrintArea,
            #invoicePrintArea * {
                visibility: visible;
            }

            #invoicePrintArea {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }

            .no-print {
                display: none !important;
            }
        }

        /* Auth modal styles */
        .auth-modal {
            transition: all 0.3s ease;
        }

        .auth-form {
            animation: fadeInUp 0.5s ease;
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }


        /* Specific buttons that should use #002F6C */
        .btn-custom-primary {
            background-color: #002F6C !important;
            color: white !important;
            border-color: #002F6C !important;
            transition: all 0.3s ease;
        }

        .btn-custom-primary:hover {
            background-color: #001f4a !important;
            border-color: #001f4a !important;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(0, 47, 108, 0.3);
        }

        /* Custom input focus styles */
        input:focus, select:focus, textarea:focus {
            border-color: #002F6C !important;
            --tw-ring-color: #002F6C !important;
            box-shadow: 0 0 0 3px rgba(0, 47, 108, 0.1) !important;
        }

    </style>
</head>

<body style="background-color: #F0EDED;">
    <!-- Authentication Modal -->
    <div id="authModal"
        class="fixed inset-0 flex items-center justify-center z-50 auth-modal" style="background: #002F6C;">
        <div class="bg-white rounded-2xl shadow-lg w-full max-w-md p-8 auth-form">

            <div id="login-container">
                <h2 class="text-2xl font-bold text-center mb-6" style="color: #002F6C;" id="authTitle">Welcome Back</h2>
                <form id="loginForm" class="space-y-4">
                    <input type="email" id="loginEmail" placeholder="Email"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2" style="--tw-ring-color: #002F6C;" required>
                    <input type="password" id="loginPassword" placeholder="Password"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" required>
                    <button type="submit"
                        class="w-full text-white py-2 rounded-lg btn-custom-primary">Login</button>
                </form>
                <p class="mt-4 text-center text-sm text-gray-600">
                    Need an account?
                    <button id="switchToSignupBtn" class="font-semibold hover:underline" style="color: #002F6C;">Sign
                        Up</button>
                </p>
            </div>

            <div id="signup-container" class="hidden">
                <h2 class="text-2xl font-bold text-center mb-6" style="color: #002F6C;">Create Account</h2>
                <form id="signupForm" class="space-y-4">
                    <input type="text" id="signupName" placeholder="Full Name"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" required>
                    <input type="email" id="signupEmail" placeholder="Email"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" required>
                    <input type="password" id="signupPassword" placeholder="Password"
                        class="w-full px-4 py-2 border rounded-lg focus:ring-2 focus:ring-purple-500" required>
                    <button type="submit"
                        class="w-full text-white py-2 rounded-lg btn-custom-primary">Sign Up</button>
                </form>
                <p class="mt-4 text-center text-sm text-gray-600">
                    Already have an account?
                    <button id="switchToLoginBtn" class="font-semibold hover:underline" style="color: #002F6C;">Log in</button>
                </p>
            </div>
        </div>
    </div>

    <!-- Pending Approval Modal -->
    <div id="pendingModal"
        class="fixed inset-0 bg-gradient-to-r from-yellow-500 to-orange-600 flex items-center justify-center z-50 hidden">
        <div class="bg-white rounded-2xl shadow-lg w-full max-w-md p-8 text-center">
            <div class="mb-6">
                <div class="w-16 h-16 bg-yellow-100 rounded-full flex items-center justify-center mx-auto mb-4">
                    <i class="fas fa-clock text-yellow-600 text-2xl"></i>
                </div>
                <h2 class="text-2xl font-bold text-gray-900 mb-2">Account Pending Approval</h2>
                <p class="text-gray-600">Your account is being reviewed by an administrator. You will receive access
                    once approved.</p>
            </div>

            <div class="space-y-4">
                <div class="flex justify-center">
                    <div class="animate-spin rounded-full h-8 w-8 border-b-2 border-yellow-600"></div>
                </div>
                <p class="text-sm text-gray-500">Please wait or contact your administrator</p>
            </div>

            <div class="mt-6 pt-6 border-t">
                <button onclick="logout()" class="text-yellow-600 hover:text-yellow-800 font-medium">
                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                </button>
            </div>
        </div>
    </div>

    <!-- Main App Content -->
    <div id="appContent">
        <!-- Navigation -->
        <nav class="bg-white shadow-lg sticky top-0 z-50">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between items-center h-16">
                    <div class="flex items-center">
                        <span
                            class="text-2xl font-bold" style="color: #002F6C;">EnrollEngineer</span>
                    </div>
                    <div class="hidden md:flex space-x-8">
                        <a href="#dashboard"
                            class="nav-link text-gray-700 hover:text-blue-600 font-medium">Dashboard</a>
                        <a href="#invoicing"
                            class="nav-link text-gray-700 hover:text-blue-600 font-medium">Invoicing</a>
                        <a href="#accounts" class="nav-link text-gray-700 hover:text-blue-600 font-medium">Accounts</a>
                        <a href="#admin" class="nav-link text-gray-700 hover:text-blue-600 font-medium"
                            id="adminNav">Admin</a>
                    </div>
                    <div class="flex items-center space-x-4">
                        <div class="relative">
                            <i
                                class="fas fa-bell text-gray-600 text-xl cursor-pointer hover:text-blue-600 transition-colors"></i>
                            <div class="notification-dot absolute -top-1 -right-1 w-3 h-3 bg-red-500 rounded-full">
                            </div>
                        </div>
                        <div class="relative">
                            <div class="w-8 h-8 rounded-full flex items-center justify-center text-white font-semibold cursor-pointer" style="background: #002F6C;"
                                id="userAvatar">
                                U
                            </div>
                            <div id="userDropdown"
                                class="hidden absolute right-0 mt-2 w-64 bg-white rounded-md shadow-lg py-2 z-50">
                                <div class="px-4 py-2 border-b">
                                    <div class="font-medium text-gray-900 break-all text-sm" id="userEmail">user@example.com</div>
                                    <div class="text-sm text-gray-500" id="userRole">User</div>
                                </div>
                                <button onclick="logout()"
                                    class="w-full text-left px-4 py-2 text-red-600 hover:bg-red-50">
                                    <i class="fas fa-sign-out-alt mr-2"></i>Logout
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="text-gray-900 py-20" style="background-color: #F0EDED;">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center">
                    <div class="animate-fade-in">
                        <h1 class="text-5xl font-bold mb-6 leading-tight">
                            Transform Your Financial Management
                            <span class="block text-blue-600">Into Pure Excellence</span>
                        </h1>
                    </div>
                </div>
            </div>
        </section>

        <!-- Dashboard Section -->
        <section id="dashboard" class="py-20" style="background-color: #F0EDED;">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Smart Performance Dashboard</h2>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                        Get real-time insights into your financial performance with our intelligent analytics engine
                    </p>
                </div>

                <div class="flex justify-end mb-6">
                    <div class="inline-flex rounded-lg border border-gray-200">
                        <button onclick="changePeriod('daily')" data-period="daily"
                            class="period-btn px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 rounded-l-lg focus:z-10 focus:ring-2 focus:ring-blue-500 focus:text-blue-700">
                            Daily
                        </button>
                        <button onclick="changePeriod('weekly')" data-period="weekly"
                            class="period-btn px-4 py-2 text-sm font-medium text-gray-700 hover:bg-gray-50 focus:z-10 focus:ring-2 focus:ring-blue-500 focus:text-blue-700">
                            Weekly
                        </button>
                        <button onclick="changePeriod('monthly')" data-period="monthly"
                            class="period-btn px-4 py-2 text-sm font-medium text-gray-700 bg-gray-100 hover:bg-gray-50 rounded-r-lg focus:z-10 focus:ring-2 focus:ring-blue-500 focus:text-blue-700">
                            Monthly
                        </button>
                    </div>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                    <div class="metric-card rounded-xl p-6 hover-scale">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-blue-100 text-sm font-medium">Total Revenue</p>
                                <p class="text-3xl font-bold text-white" id="totalRevenue">‚Çπ0</p>
                                <p class="text-green-300 text-sm">+12.5% from last period</p>
                            </div>
                            <i class="fas fa-chart-line text-3xl text-blue-200"></i>
                        </div>
                    </div>

                    <div class="dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Outstanding Invoices</p>
                                <p class="text-3xl font-bold text-gray-900" id="outstandingInvoices">‚Çπ0</p>
                                <p class="text-orange-500 text-sm" id="pendingCount">0 pending payments</p>
                            </div>
                            <i class="fas fa-file-invoice-dollar text-3xl text-orange-500"></i>
                        </div>
                    </div>

                    <div class="dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Monthly Expenses</p>
                                <p class="text-3xl font-bold text-gray-900" id="monthlyExpenses">‚Çπ0</p>
                                <p class="text-red-500 text-sm">-8.2% from last period</p>
                            </div>
                            <i class="fas fa-credit-card text-3xl text-red-500"></i>
                        </div>
                    </div>

                    <div class="dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between">
                            <div>
                                <p class="text-gray-600 text-sm font-medium">Net Profit</p>
                                <p class="text-3xl font-bold text-gray-900" id="netProfit">‚Çπ0</p>
                                <p class="text-green-500 text-sm">+18.7% from last period</p>
                            </div>
                            <i class="fas fa-coins text-3xl text-green-500"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900">Revenue Trend</h3>
                            <div class="text-sm text-gray-500">Values in ‚Çπ</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="revenueChart"></canvas>
                        </div>
                    </div>

                    <div class="dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-4">
                            <h3 class="text-xl font-semibold text-gray-900">Expense Breakdown</h3>
                            <div class="text-sm text-gray-500">Values in ‚Çπ</div>
                        </div>
                        <div class="chart-container">
                            <canvas id="expenseChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Invoicing Section -->
        <section id="invoicing" class="py-20" style="background-color: #F0EDED;">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Professional Invoicing</h2>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                        Create, send, and track invoices with our intelligent billing system
                    </p>
                </div>

                <div class="dashboard-card rounded-xl p-6">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-xl font-semibold text-gray-900">Recent Invoices</h3>
                        <div class="flex space-x-3">
                            <button onclick="exportToExcel()"
                                class="btn-custom-primary px-4 py-2 rounded-lg hover-scale flex items-center">
                                <i class="fas fa-file-excel mr-2"></i>Export Data
                            </button>
                            <button onclick="openInvoiceModal()"
                                class="btn-custom-primary px-4 py-2 rounded-lg hover-scale">
                                <i class="fas fa-plus mr-2"></i>New Invoice
                            </button>
                        </div>
                    </div>

                    <div class="overflow-x-auto">
                        <table class="w-full">
                            <thead>
                                <tr class="border-b border-gray-200">
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Invoice #</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Client</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Amount</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Status</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Billing Date</th>
                                    <th class="text-left py-3 px-4 font-semibold text-gray-700">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="invoiceTableBody">
                                <!-- Invoices will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </section>

        <!-- Accounts Section -->
        <section id="accounts" class="py-20" style="background-color: #F0EDED;">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="text-center mb-10">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Account Management</h2>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                        Comprehensive financial account tracking with intelligent categorization
                    </p>
                </div>

                <div class="flex justify-between items-center mb-6 border-b border-gray-200">
                    <div class="flex space-x-6 overflow-x-auto">
                        <button
                            class="tab-btn py-3 px-1 border-b-2 border-indigo-500 text-indigo-600 font-medium whitespace-nowrap"
                            data-tab="Employee Payment">Employee Payment</button>
                        <button
                            class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-indigo-600 hover:border-gray-300 whitespace-nowrap"
                            data-tab="Allowance">Allowance</button>
                        <button
                            class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-indigo-600 hover:border-gray-300 whitespace-nowrap"
                            data-tab="Reimbursement">Reimbursement</button>
                        <button
                            class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-indigo-600 hover:border-gray-300 whitespace-nowrap"
                            data-tab="Purchase">Purchase</button>
                        <button
                            class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-indigo-600 hover:border-gray-300 whitespace-nowrap"
                            data-tab="Vendor Payment">Vendor Payment</button>
                        <button
                            class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-indigo-600 hover:border-gray-300 whitespace-nowrap"
                            data-tab="Miscellaneous Income">Misc. Income</button>
                        <button
                            class="tab-btn py-3 px-1 border-b-2 border-transparent text-gray-600 hover:text-indigo-600 hover:border-gray-300 whitespace-nowrap"
                            data-tab="Miscellaneous Expense">Misc. Expense</button>
                    </div>
                    <button id="openModal"
                        class="ml-2 flex-shrink-0 px-4 py-2 btn-custom-primary rounded-lg shadow transition">
                        <i class="fas fa-plus mr-1"></i>Add Transaction
                    </button>
                </div>

                <div class="overflow-x-auto shadow rounded-lg">
                    <table class="min-w-full bg-white rounded-lg overflow-hidden">
                        <thead class="bg-gray-100 text-gray-600 text-sm">
                            <tr>
                                <th class="px-6 py-3 text-left">Date</th>
                                <th class="px-6 py-3 text-left">Description</th>
                                <th class="px-6 py-3 text-left">Notes</th>
                                <th class="px-6 py-3 text-right">Amount</th>
                                <th class="px-6 py-3 text-center">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="transactionTable" class="text-gray-700 text-sm">
                            <!-- Transactions will be loaded here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- Admin Section -->
        <section id="admin" class="py-20 flex justify-center" style="background-color: #F0EDED;">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 w-full">
                <div class="text-center mb-16">
                    <h2 class="text-4xl font-bold text-gray-900 mb-4">Admin Control Center</h2>
                    <p class="text-xl text-gray-600 max-w-3xl mx-auto">
                        Manage users, permissions, and system settings with enterprise-grade security
                    </p>
                </div>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8 justify-center">
                    <div class="dashboard-card rounded-xl p-6">
                        <div class="flex items-center justify-between mb-6">
                            <h3 class="text-xl font-semibold text-gray-900">User Management</h3>
                            <button onclick="refreshUsers()"
                                class="btn-custom-primary px-4 py-2 rounded-lg text-sm hover-scale">
                                <i class="fas fa-sync mr-2"></i>Refresh
                            </button>
                        </div>

                        <div class="space-y-4" id="userList">
                            <!-- Users will be loaded here -->
                        </div>
                    </div>
                    <div class="dashboard-card rounded-xl p-6">
                        <h3 class="text-xl font-semibold text-gray-900 mb-6">System Settings</h3>

                        <div class="space-y-6">
                            <div>
                                <h4 class="font-medium text-gray-900 mb-3">Security</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-600">Two-Factor Authentication</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" value="" class="sr-only peer" checked>
                                            <div
                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                            </div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-600">Auto Backup</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" value="" class="sr-only peer" checked>
                                            <div
                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                            <div>
                                <h4 class="font-medium text-gray-900 mb-3">Notifications</h4>
                                <div class="space-y-3">
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-600">Email Alerts</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" value="" class="sr-only peer" checked>
                                            <div
                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                            </div>
                                        </label>
                                    </div>
                                    <div class="flex items-center justify-between">
                                        <span class="text-gray-600">SMS Notifications</span>
                                        <label class="relative inline-flex items-center cursor-pointer">
                                            <input type="checkbox" value="" class="sr-only peer">
                                            <div
                                                class="w-11 h-6 bg-gray-200 rounded-full peer peer-focus:ring-4 peer-focus:ring-blue-300 peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-0.5 after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-blue-600">
                                            </div>
                                        </label>
                                    </div>
                                </div>
                            </div>

                                <div>
                                <h4 class="font-medium text-gray-900 mb-3">Data Management</h4>
                                <div class="space-y-3">
                                    <button onclick="exportAllData()"
                                        class="w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i class="fas fa-download text-blue-600 mr-3"></i>
                                            <span>Export All Data</span>
                                        </div>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </button>
                                    <button onclick="resetInvoiceCounter()"
                                        class="w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i class="fas fa-refresh text-orange-600 mr-3"></i>
                                            <span>Reset Invoice Counter</span>
                                        </div>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </button>
                                    <button
                                        class="w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i class="fas fa-shield-alt text-green-600 mr-3"></i>
                                            <span>Backup Settings</span>
                                        </div>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </button>
                                    <button
                                        class="w-full text-left p-3 rounded-lg hover:bg-gray-50 transition-colors flex items-center justify-between">
                                        <div class="flex items-center">
                                            <i class="fas fa-history text-purple-600 mr-3"></i>
                                            <span>Audit Logs</span>
                                        </div>
                                        <i class="fas fa-chevron-right text-gray-400"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-gray-900 text-gray-300 border-t border-gray-800">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-4 flex items-center justify-between">
            <div class="text-sm">¬© 2025 EnrollEngineer. All rights reserved.</div>
            <div class="text-sm">Build with <span class="text-pink-500">‚ù§</span> @EnrollEngineer</div>
        </div>
    </footer>

    <!-- Invoice Modal -->
    <div id="invoiceModal" class="fixed inset-0 bg-black bg-opacity-50 hidden z-50 overflow-y-auto">
        <div class="flex items-start justify-center min-h-screen p-4 py-8">
            <div class="bg-white rounded-lg w-full max-w-4xl mx-auto my-8 border shadow-lg max-h-screen overflow-y-auto" style="font-family: Arial, sans-serif;">
                <div class="sticky top-0 bg-white flex justify-between items-center p-6 border-b z-10">
                    <h3 id="invoiceModalTitle" class="text-3xl font-bold text-gray-900">Create New Invoice</h3>
                    <button id="closeInvoiceModalBtn" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times text-2xl"></i>
                    </button>
                </div>

                <div class="p-8">
                    <form id="invoiceForm">
                        <!-- Company Information (Fixed) -->
                        <div class="mb-8">
                            <div class="text-center">
                                <h1 class="text-4xl font-bold text-blue-800 mb-2">EnrollEngineer</h1>
                                <p class="text-lg text-gray-700">Phone: 8446777225</p>
                                <p class="text-lg text-gray-700">Email: enrollengineer24@gmail.com</p>
                            </div>
                            <!-- Hidden inputs for form data -->
                            <input type="hidden" id="companyName" value="EnrollEngineer">
                            <input type="hidden" id="companyPhone" value="8446777225">
                            <input type="hidden" id="companyEmail" value="enrollengineer24@gmail.com">
                        </div>

                        <!-- Invoice Details -->
                        <div class="mb-8">
                            <h4 class="text-2xl font-semibold text-gray-900 mb-4">Invoice Details</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-2">Invoice Number</label>
                                    <input type="text" id="invoiceNumber" class="w-full px-4 py-3 border border-gray-300 rounded-lg bg-gray-100" readonly>
                                </div>
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-2">Date</label>
                                    <input type="date" id="invoiceDate" class="w-full px-4 py-3 border border-gray-300 rounded-lg" required>
                                </div>
                            </div>
                        </div>

                        <!-- Bill To -->
                        <div class="mb-8">
                            <h4 class="text-2xl font-semibold text-gray-900 mb-4">Bill To</h4>
                            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-2">Client Name</label>
                                    <input type="text" id="clientName" class="w-full px-4 py-3 border rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-2">Mobile Number</label>
                                    <input type="tel" id="clientMobile" class="w-full px-4 py-3 border rounded-lg" required>
                                </div>
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-2">Email</label>
                                    <input type="email" id="clientEmail" class="w-full px-4 py-3 border rounded-lg">
                                </div>
                                <div>
                                    <label class="block text-lg font-medium text-gray-700 mb-2">State/Pin Code</label>
                                    <input type="text" id="clientStatePin" class="w-full px-4 py-3 border rounded-lg" required>
                                </div>
                            </div>
                            <div class="mt-4">
                                <label class="block text-lg font-medium text-gray-700 mb-2">Address</label>
                                <textarea id="invoiceAddress" rows="3" class="w-full px-4 py-3 border rounded-lg" required></textarea>
                            </div>
                        </div>

                        <!-- Invoice Items -->
                        <div class="mb-8">
                            <h4 class="text-2xl font-semibold text-gray-900 mb-4">Invoice Items</h4>
                            <div class="space-y-4">
                                <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
                                    <div>
                                        <label class="block text-lg font-medium text-gray-700 mb-2">Description</label>
                                        <select id="packageSelect" class="w-full px-4 py-3 border rounded-lg" onchange="updatePackageRate()" required>
                                            <option value="">Select Package</option>
                                            <option value="standard" data-rate="2000">Standard Package</option>
                                            <option value="premium" data-rate="2500">Premium Package</option>
                                        </select>
                                    </div>
                                    <div>
                                        <label class="block text-lg font-medium text-gray-700 mb-2">Quantity</label>
                                        <input type="number" id="quantity" class="w-full px-4 py-3 border rounded-lg" value="1" min="1" onchange="calculateTotal()" required>
                                    </div>
                                    <div>
                                        <label class="block text-lg font-medium text-gray-700 mb-2">Rate (‚Çπ)</label>
                                        <input type="number" id="rate" class="w-full px-4 py-3 border rounded-lg bg-gray-100" readonly>
                                    </div>
                                    <div>
                                        <label class="block text-lg font-medium text-gray-700 mb-2">Amount (‚Çπ)</label>
                                        <input type="number" id="amount" class="w-full px-4 py-3 border rounded-lg bg-gray-100" readonly>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Total Section -->
                        <div class="mb-8 bg-gray-50 p-6 rounded-lg">
                            <div class="text-right">
                                <div class="text-2xl font-bold text-gray-900">
                                    <span>Total Amount: ‚Çπ</span><span id="totalAmount">0</span>
                                </div>
                            </div>
                        </div>

                        <!-- Terms and Conditions -->
                        <div class="mb-8">
                            <h4 class="text-2xl font-semibold text-gray-900 mb-4">Terms and Conditions</h4>
                            <div class="text-lg text-gray-700 space-y-2">
                                <p>1. Payment is due within 30 days of invoice date.</p>
                                <p>2. Late payments may incur additional charges.</p>
                                <p>3. All disputes must be reported within 7 days of invoice receipt.</p>
                                <p>4. Services are subject to our standard terms and conditions.</p>
                            </div>
                        </div>

                        <!-- PAID Stamp Section -->
                        <div class="mb-8 text-center">
                            <div class="inline-block">
                                <label class="flex items-center text-lg">
                                    <input type="checkbox" id="paidStamp" class="mr-3 w-5 h-5">
                                    <span class="text-green-600 font-bold text-2xl">Mark as PAID</span>
                                </label>
                            </div>
                        </div>

                        <div class="flex justify-end space-x-4">
                            <button type="button" id="cancelInvoiceBtn" class="px-8 py-3 border-2 border-gray-300 rounded-lg text-lg font-medium hover:bg-gray-50">Cancel</button>
                            <button type="submit" id="invoiceSubmitBtn" class="px-8 py-3 bg-blue-600 text-white rounded-lg text-lg font-medium hover:bg-blue-700">Create Invoice</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Transaction Modal -->
    <div id="modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4">
        <div class="bg-white rounded-lg w-full max-w-md p-6 shadow-lg transform transition-all scale-95"
            id="modal-content">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-xl font-semibold" id="modal-title">Add Transaction</h3>
                <button id="closeModal" class="text-gray-500 hover:text-gray-800">&times;</button>
            </div>
            <form id="transactionForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Date</label>
                    <input type="date" id="date" name="date" required
                        class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Description</label>
                    <input type="text" id="description" name="description" required
                        class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Notes</label>
                    <input type="text" id="notes" name="notes"
                        class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Amount</label>
                    <input type="number" id="amount" name="amount" required
                        class="mt-1 block w-full border-gray-300 rounded-lg shadow-sm focus:ring-indigo-500 focus:border-indigo-500" />
                </div>
                <div class="flex justify-end space-x-3 pt-2">
                    <button type="button" id="cancelModal" class="px-4 py-2 rounded-lg border">Cancel</button>
                    <button type="submit" id="submitBtn"
                        class="px-4 py-2 rounded-lg bg-indigo-600 text-white hover:bg-indigo-700">Add</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Print Area -->
    <div id="invoicePrintArea" class="hidden"></div>

    <!-- Complete JavaScript Integration -->
    <script>
        // Global Variables
        let currentUser = null;
        let currentPeriod = 'monthly';
        let currentEditingInvoiceId = null;
        let currentTab = "Employee Payment";
        let currentEditingId = null;
        let invoicesData = [];
        let accountsData = {};
        let users = [];
        let revenueChart, expenseChart, floatingChart;

        // ‚ú® NEW: Function to Generate Invoice Number
        async function generateInvoiceNumber(billType) {
            const prefixMap = {
                "BILL OF SUPPLY": "BOS",
                "RECEIPT OF PAYMENT": "ROP",
                "RECEIPT OF PURCHASE": "PUR",
                "RECEIPT OF SAMPLE": "ROS",
                "QUOTATION": "QUO",
                "INVOICE": "INV"
            };
            const prefix = prefixMap[billType] || "INV";
            const year = new Date().getFullYear();
            const counterId = `${prefix}-${year}`;
            const counterRef = window.firestoreDoc(window.firestoreDb, "counters", counterId);

            let nextNumber = 1;
            try {
                await window.runTransaction(window.firestoreDb, async (transaction) => {
                    const counterDoc = await transaction.get(counterRef);
                    if (counterDoc.exists()) {
                        nextNumber = counterDoc.data().current + 1;
                        transaction.update(counterRef, { current: nextNumber });
                    } else {
                        transaction.set(counterRef, { current: 1 });
                    }
                });
            } catch (error) {
                console.error("Transaction failed: ", error);
                return `${prefix}/${year}/${Math.floor(1000 + Math.random() * 9000)}`;
            }

            const sequence = String(nextNumber).padStart(3, '0');
            return `${prefix}/${year}/${sequence}`;
        }

        // ‚ú® NEW: Function to reset invoice counter (for admin use)
        async function resetInvoiceCounter() {
            if (!currentUser || currentUser.role !== 'Admin') {
                showNotification('Only admin can reset invoice counter', 'error');
                return;
            }
            
            const year = new Date().getFullYear();
            const counterId = `INV-${year}`;
            const counterRef = window.firestoreDoc(window.firestoreDb, "counters", counterId);
            
            try {
                await window.firestoreDeleteDoc(counterRef);
                showNotification('Invoice counter reset successfully. Next invoice will be INV/2025/001', 'success');
                console.log('Invoice counter reset to start from 001');
            } catch (error) {
                console.error('Error resetting counter:', error);
                showNotification('Failed to reset invoice counter', 'error');
            }
        }

        // ‚ú® NEW: Function to handle conditional field visibility
        function updateRatePerUnitVisibility() {
            const billType = document.getElementById("billType").value;
            const wrapper = document.getElementById("ratePerUnitWrapper");
            if (billType === "Bill of Supply" || billType === "Quotation") {
                wrapper.style.display = "block";
            } else {
                wrapper.style.display = "none";
                document.getElementById("ratePerUnit").value = 0; // Reset value when hidden
            }
        }

        // Utility Functions
        const formatINR = (amount) => {
            return new Intl.NumberFormat('en-IN', {
                style: 'currency',
                currency: 'INR',
                maximumFractionDigits: 0
            }).format(amount);
        };

        // Chart Data
        const floatingChartData = {
            daily: {
                labels: ['6am', '9am', '12pm', '3pm', '6pm', '9pm', '12am'],
                values: [420000, 580000, 690000, 750000, 820000, 880000, 920000],
                growth: 32.8,
                revenue: 9200000,
                rate: 94
            },
            weekly: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                values: [3200000, 3800000, 3500000, 4100000, 3900000, 4300000, 4000000],
                growth: 28.5,
                revenue: 40000000,
                rate: 88
            },
            monthly: {
                labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                values: [45000000, 52000000, 48000000, 55000000, 51000000, 54739200],
                growth: 25.2,
                revenue: 54739200,
                rate: 92
            }
        };

        const financialData = {
            daily: {
                revenue: 8473920,
                outstandingInvoices: 1245670,
                monthlyExpenses: 2348910,
                netProfit: 6125010,
                revenueData: [320000, 380000, 350000, 410000, 390000, 430000, 400000],
                expenseData: [210000, 230000, 200000, 240000, 220000, 260000, 240000]
            },
            weekly: {
                revenue: 72568900,
                outstandingInvoices: 9876500,
                monthlyExpenses: 19876500,
                netProfit: 52692400,
                revenueData: [15000000, 16500000, 14800000, 17200000],
                expenseData: [9000000, 9800000, 8900000, 10200000]
            },
            monthly: {
                revenue: 54739200,
                outstandingInvoices: 7456700,
                monthlyExpenses: 15489100,
                netProfit: 39250100,
                revenueData: [45000000, 52000000, 48000000, 55000000, 51000000, 54739200],
                expenseData: [28000000, 31000000, 29000000, 33000000, 30000000, 32000000]
            }
        };

        // Authentication Functions
        function showAuthModal() {
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('appContent').style.display = 'none';
        }

        function hideAuthModal() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('appContent').style.display = 'block';
        }

        function showPendingModal() {
            document.getElementById('authModal').classList.add('hidden');
            document.getElementById('pendingModal').classList.remove('hidden');
            document.getElementById('appContent').style.display = 'none';
        }

        function hidePendingModal() {
            document.getElementById('pendingModal').classList.add('hidden');
        }

        function switchToSignup() {
            document.getElementById('login-container').classList.add('hidden');
            document.getElementById('signup-container').classList.remove('hidden');
        }

        function switchToLogin() {
            document.getElementById('login-container').classList.remove('hidden');
            document.getElementById('signup-container').classList.add('hidden');
        }

        async function handleLogin(e) {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;

            try {
                const userCredential = await window.signInWithEmailAndPassword(window.firebaseAuth, email, password);
                const user = userCredential.user;

                // Check user status in Firestore
                const userDoc = await window.firestoreGetDocs(
                    window.firestoreQuery(
                        window.firestoreCollection(window.firestoreDb, 'users'),
                        window.firestoreWhere('email', '==', email)
                    )
                );

                if (userDoc.empty) {
                    showNotification('User not found in system', 'error');
                    return;
                }

                const userData = userDoc.docs[0].data();
                if (userData.status === 'pending') {
                    showPendingModal();
                    return;
                } else if (userData.status === 'rejected') {
                    showNotification('Access denied. Contact administrator.', 'error');
                    await window.signOut(window.firebaseAuth);
                    return;
                }

                currentUser = { ...userData, uid: user.uid };
                updateUserDisplay();
                hideAuthModal();
                initApp();
                showNotification('Login successful!', 'success');
            } catch (error) {
                console.error('Login error:', error);
                showNotification('Login failed: ' + error.message, 'error');
            }
        }

        async function handleSignup(e) {
            e.preventDefault();
            const name = document.getElementById('signupName').value;
            const email = document.getElementById('signupEmail').value;
            const password = document.getElementById('signupPassword').value;

            if (!name || !email || !password) {
                showNotification('Please fill in all fields', 'error');
                return;
            }

            try {
                // Create user with Firebase Authentication
                const userCredential = await window.createUserWithEmailAndPassword(window.firebaseAuth, email, password);
                const user = userCredential.user;

                // Create user document in Firestore
                await window.firestoreAddDoc(window.firestoreCollection(window.firestoreDb, 'users'), {
                    uid: user.uid,
                    name: name,
                    email: email,
                    role: 'User',
                    status: 'pending',
                    createdAt: new Date()
                });

                showNotification('‚úÖ Account created successfully! Your account is pending admin approval.', 'success');
                switchToLogin();
                document.getElementById('signupForm').reset();
                
            } catch (error) {
                console.error('Signup error:', error);
                let errorMessage = 'Signup failed: ';
                
                if (error.code === 'auth/email-already-in-use') {
                    errorMessage += 'An account with this email already exists. Please use the login form.';
                } else if (error.code === 'auth/weak-password') {
                    errorMessage += 'Password should be at least 6 characters long.';
                } else if (error.code === 'auth/invalid-email') {
                    errorMessage += 'Please enter a valid email address.';
                } else {
                    errorMessage += error.message || 'Please try again.';
                }
                
                showNotification(errorMessage, 'error');
            }
        }
        
        function showExistingEmailOptions(email) {
            // Create a modal to show options for existing email
            const existingEmailModal = document.createElement('div');
            existingEmailModal.id = 'existingEmailModal';
            existingEmailModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50';
            
            existingEmailModal.innerHTML = `
                <div class="bg-white rounded-2xl shadow-lg w-full max-w-md p-8">
                    <h2 class="text-2xl font-bold text-center text-blue-600 mb-6">Email Already Registered</h2>
                    <p class="text-gray-600 text-center mb-6">
                        The email <strong>${email}</strong> is already registered.<br>
                        What would you like to do?
                    </p>
                    
                    <div class="space-y-3">
                        <button onclick="switchToLoginFromExisting('${email}')" 
                                class="w-full bg-blue-600 text-white py-3 rounded-lg hover:bg-blue-700 transition-colors">
                            <i class="fas fa-sign-in-alt mr-2"></i>Login with this email
                        </button>
                        
                        <button onclick="sendPasswordReset('${email}')" 
                                class="w-full bg-orange-600 text-white py-3 rounded-lg hover:bg-orange-700 transition-colors">
                            <i class="fas fa-key mr-2"></i>Reset Password
                        </button>
                        
                        <button onclick="closeExistingEmailModal()" 
                                class="w-full bg-gray-400 text-white py-3 rounded-lg hover:bg-gray-500 transition-colors">
                            <i class="fas fa-times mr-2"></i>Try Different Email
                        </button>
                    </div>
                </div>
            `;
            
            document.body.appendChild(existingEmailModal);
        }
        
        function switchToLoginFromExisting(email) {
            closeExistingEmailModal();
            switchToLogin();
            document.getElementById('loginEmail').value = email;
            document.getElementById('loginPassword').focus();
            showNotification('‚ÑπÔ∏è Please enter your password to login', 'info');
        }
        
        async function sendPasswordReset(email) {
            try {
                await window.sendPasswordResetEmail(window.firebaseAuth, email);
                showNotification('‚úÖ Password reset email sent! Check your inbox.', 'success');
                closeExistingEmailModal();
            } catch (error) {
                console.error('Password reset error:', error);
                showNotification('Error sending password reset: ' + error.message, 'error');
            }
        }
        
        function closeExistingEmailModal() {
            const modal = document.getElementById('existingEmailModal');
            if (modal) {
                modal.remove();
            }
        }

        async function logout() {
            try {
                await window.signOut(window.firebaseAuth);
                currentUser = null;
                hidePendingModal();
                showAuthModal();
                showNotification('Logged out successfully', 'success');
            } catch (error) {
                console.error('Logout error:', error);
            }
        }

        function updateUserDisplay() {
            if (currentUser) {
                const avatar = document.getElementById('userAvatar');
                const emailEl = document.getElementById('userEmail');
                const roleEl = document.getElementById('userRole');

                avatar.textContent = currentUser.name ? currentUser.name.charAt(0).toUpperCase() : 'U';
                emailEl.textContent = currentUser.email;
                roleEl.textContent = currentUser.role;

                // Show/hide admin nav based on role - only Admin can see Admin Control Center
                const adminNav = document.getElementById('adminNav');
                if (currentUser.role === 'Admin') {
                    adminNav.style.display = 'block';
                } else {
                    adminNav.style.display = 'none';
                }

                // Apply role-based UI restrictions
                applyRoleBasedRestrictions();
            }
        }

        function applyRoleBasedRestrictions() {
            const userRole = currentUser?.role;
            
            // Reset previous restrictions
            document.querySelectorAll('.status-dropdown').forEach(el => {
                el.style.display = 'block';
                el.disabled = false;
            });
            document.querySelectorAll('.status-readonly').forEach(el => el.style.display = 'none');
            
            // Get all interactive elements that should be disabled for Users
            const editableElements = [
                // Invoice creation and editing
                'button[onclick="openInvoiceModal()"]', // New Invoice button
                'button[onclick*="openInvoiceModal"]', // Alternative New Invoice button
                '.invoice-edit-btn', // Edit buttons in invoice table
                // '.invoice-delete-btn', // Delete buttons in invoice table - TEMPORARILY ENABLED
                'button[onclick*="editInvoice"]', // Edit invoice buttons by onclick
                // 'button[onclick*="deleteInvoice"]', // Delete invoice buttons by onclick - TEMPORARILY ENABLED
                'button[title="Edit"]', // Edit buttons by title
                // 'button[title="Delete"]', // Delete buttons by title - TEMPORARILY ENABLED
                // Transaction creation and editing
                '#openModal', // Add Transaction button
                '.transaction-edit-btn', // Edit buttons in transaction table
                '.transaction-delete-btn', // Delete buttons in transaction table
                'button[onclick*="editTransaction"]', // Edit transaction buttons by onclick
                'button[onclick*="deleteTransaction"]', // Delete transaction buttons by onclick
                // Export and action buttons
                'button[onclick*="exportToExcel"]', // Export buttons
                // Status dropdowns
                '.status-dropdown', // Status dropdown in invoices
                'select[onchange*="changeInvoiceStatus"]' // Invoice status changes
            ];

            if (userRole === 'User') {
                // Make interface view-only for Users
                editableElements.forEach(selector => {
                    const elements = document.querySelectorAll(selector);
                    elements.forEach(element => {
                        if (element) {
                            element.style.display = 'none';
                        }
                    });
                });
                
                // Show readonly status spans instead of dropdowns
                document.querySelectorAll('.status-readonly').forEach(el => el.style.display = 'inline-block');
                
                // Hide action columns headers and cells completely for Users
                const actionHeaders = document.querySelectorAll('th');
                actionHeaders.forEach((th, index) => {
                    if (th.textContent.toLowerCase().includes('actions')) {
                        th.style.display = 'none';
                        
                        // Hide corresponding cells in all rows
                        const table = th.closest('table');
                        if (table) {
                            const rows = table.querySelectorAll('tbody tr');
                            rows.forEach(row => {
                                const cells = row.querySelectorAll('td');
                                if (cells[index]) {
                                    cells[index].style.display = 'none';
                                }
                            });
                        }
                    }
                });
                
                // Also hide the last column (Actions) in both invoice and transaction tables
                document.querySelectorAll('table tbody tr').forEach(row => {
                    const lastCell = row.lastElementChild;
                    if (lastCell && (lastCell.querySelector('.invoice-edit-btn') || lastCell.querySelector('.transaction-edit-btn'))) {
                        lastCell.style.display = 'none';
                    }
                });
                
                // Add read-only indicators
                addReadOnlyIndicators();
            } else {
                // Remove read-only banner for non-Users
                const existingBanner = document.getElementById('readOnlyBanner');
                if (existingBanner) {
                    existingBanner.remove();
                }
                
                if (userRole === 'Manager') {
                    // Managers have full access except Admin Control Center
                    // Admin Control Center is already hidden by updateUserDisplay
                }
            }
            // Admin has full access to everything - no restrictions needed
        }

        function addReadOnlyIndicators() {
            // Add a visual indicator that the interface is read-only
            const readOnlyBanner = document.createElement('div');
            readOnlyBanner.id = 'readOnlyBanner';
            readOnlyBanner.className = 'fixed top-16 left-0 right-0 bg-blue-100 text-blue-800 text-center py-2 z-40';
            readOnlyBanner.innerHTML = '<i class="fas fa-eye mr-2"></i>Read-Only Mode - Contact administrator for edit access';
            
            // Remove existing banner if present
            const existingBanner = document.getElementById('readOnlyBanner');
            if (existingBanner) {
                existingBanner.remove();
            }
            
            document.body.appendChild(readOnlyBanner);
        }

        function toggleUserDropdown() {
            const dropdown = document.getElementById('userDropdown');
            dropdown.classList.toggle('hidden');
        }

        // Firebase Data Functions
        async function loadInvoices() {
            try {
                const querySnapshot = await window.firestoreGetDocs(window.firestoreCollection(window.firestoreDb, "invoices"));
                invoicesData = [];
                querySnapshot.forEach((doc) => {
                    invoicesData.push({ id: doc.id, ...doc.data() });
                });
                // Capture all IDs from remote BEFORE filtering
                const allRemoteIds = new Set(invoicesData.map(i => i.id));
                // Filter out invoices that were locally marked as deleted (fallback when remote delete fails)
                try {
                    const deleted = JSON.parse(localStorage.getItem('deletedInvoices') || '[]');
                    if (Array.isArray(deleted) && deleted.length) {
                        // Hide any locally-deleted invoices from the UI
                        invoicesData = invoicesData.filter(inv => !deleted.includes(inv.id));
                        // Clean the local list: keep only IDs that still exist remotely
                        const cleaned = deleted.filter(id => allRemoteIds.has(id));
                        if (cleaned.length !== deleted.length) {
                            localStorage.setItem('deletedInvoices', JSON.stringify(cleaned));
                        }
                    }
                } catch (err) {
                    console.warn('Failed to read deletedInvoices from localStorage', err);
                }
                renderInvoiceTable();
                updateFinancialMetrics();
                
                // Apply role-based restrictions after loading data
                setTimeout(() => applyRoleBasedRestrictions(), 100);
            } catch (e) {
                console.error("‚ùå Error loading invoices:", e);
                showNotification('Failed to load invoices', 'error');
            }
        }

        async function saveInvoice(invoice) {
            try {
                console.log('Saving invoice:', invoice);
                
                if (currentEditingInvoiceId) {
                    // Update existing invoice
                    try {
                        if (window.firestoreDb && window.firestoreUpdateDoc) {
                            await window.firestoreUpdateDoc(
                                window.firestoreDoc(window.firestoreDb, "invoices", currentEditingInvoiceId),
                                invoice
                            );
                        }
                    } catch (err) {
                        console.warn('Firestore update failed, continuing with local update:', err);
                    }
                    
                    // Update in local array
                    const index = invoicesData.findIndex(inv => inv.id === currentEditingInvoiceId);
                    if (index !== -1) {
                        invoicesData[index] = { ...invoicesData[index], ...invoice };
                    }
                    showNotification('Invoice updated successfully', 'success');
                    
                } else {
                    // Create new invoice
                    let newInvoiceId;
                    let persisted = false;
                    
                    if (window.firestoreDb && window.firestoreAddDoc) {
                        try {
                            const docRef = await window.firestoreAddDoc(
                                window.firestoreCollection(window.firestoreDb, "invoices"),
                                invoice
                            );
                            newInvoiceId = docRef.id;
                            persisted = true;
                            console.log('Firestore assigned ID:', newInvoiceId);
                        } catch (err) {
                            console.warn('Firestore add failed, saving locally:', err);
                        }
                    }
                    
                    if (!newInvoiceId) {
                        // Fallback: generate local ID
                        newInvoiceId = 'invoice_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                        console.log('Generated fallback ID:', newInvoiceId);
                    }
                    
                    // Add to local array with ID
                    const newInvoice = { ...invoice, id: newInvoiceId };
                    invoicesData.push(newInvoice);

                    // If this ID was previously locally deleted, remove it from the shadow list
                    try {
                        const deleted = JSON.parse(localStorage.getItem('deletedInvoices') || '[]');
                        const idx = deleted.indexOf(newInvoiceId);
                        if (idx !== -1) {
                            deleted.splice(idx, 1);
                            localStorage.setItem('deletedInvoices', JSON.stringify(deleted));
                        }
                    } catch {}

                    console.log('Invoice added locally. Total invoices:', invoicesData.length, 'Persisted:', persisted);
                    
                    showNotification('Invoice created successfully', 'success');
                }
                
                // Update UI
                renderInvoiceTable();
                updateFinancialMetrics();
                closeInvoiceModal();
                
            } catch (e) {
                console.error('‚ùå Error saving invoice:', e);
                // Final fallback: still display locally
                try {
                    const fallbackId = 'invoice_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    invoicesData.push({ ...invoice, id: fallbackId });
                    renderInvoiceTable();
                    updateFinancialMetrics();
                    closeInvoiceModal();
                    showNotification('Saved locally (offline). Firestore sync failed.', 'info');
                } catch (inner) {
                    console.error('Local fallback failed:', inner);
                    showNotification('Failed to save invoice', 'error');
                }
            }
        }

        async function loadTransactions() {
            try {
                const querySnapshot = await window.firestoreGetDocs(window.firestoreCollection(window.firestoreDb, "transactions"));
                accountsData = {};
                querySnapshot.forEach((doc) => {
                    const transaction = { id: doc.id, ...doc.data() };
                    const category = transaction.category || "Miscellaneous Expense";

                    if (!accountsData[category]) {
                        accountsData[category] = [];
                    }

                    accountsData[category].push(transaction);
                });
                renderTable(currentTab);
                updateFinancialMetrics();
                
                // Apply role-based restrictions after loading data
                setTimeout(() => applyRoleBasedRestrictions(), 100);
            } catch (e) {
                console.error("‚ùå Error loading transactions:", e);
                showNotification('Failed to load transactions', 'error');
            }
        }

        async function saveTransaction(transaction) {
            try {
                if (currentEditingId) {
                    await window.firestoreUpdateDoc(window.firestoreDoc(window.firestoreDb, "transactions", currentEditingId), transaction);
                    showNotification('Transaction updated successfully', 'success');
                } else {
                    await window.firestoreAddDoc(window.firestoreCollection(window.firestoreDb, "transactions"), transaction);
                    showNotification('Transaction created successfully', 'success');
                }
                loadTransactions();
                closeModal();
            } catch (e) {
                console.error("‚ùå Error saving transaction:", e);
                showNotification('Failed to save transaction', 'error');
            }
        }
        
        // This is the function I am replacing below.
        async function loadUsers() {
            if (!currentUser || currentUser.role !== 'Admin') return;

            try {
                const querySnapshot = await window.firestoreGetDocs(window.firestoreCollection(window.firestoreDb, "users"));
                users = [];
                querySnapshot.forEach((doc) => {
                    users.push({ id: doc.id, ...doc.data() });
                });
                renderUserList();
            } catch (e) {
                console.error("‚ùå Error loading users:", e);
                showNotification('Failed to load users', 'error');
            }
        }

        async function updateUserStatus(userId, status) {
            try {
                await window.firestoreUpdateDoc(window.firestoreDoc(window.firestoreDb, "users", userId), { status: status });
                showNotification(`User ${status} successfully`, 'success');
                loadUsers();
            } catch (e) {
                console.error("‚ùå Error updating user:", e);
                showNotification('Failed to update user', 'error');
            }
        }

        // Chart Functions
        function initCharts() {
            // Destroy existing charts if they exist
            if (revenueChart) {
                revenueChart.destroy();
                revenueChart = null;
            }
            if (expenseChart) {
                expenseChart.destroy();
                expenseChart = null;
            }

            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                revenueChart = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Revenue',
                            data: financialData.monthly.revenueData,
                            borderColor: '#667eea',
                            tension: 0.3,
                            fill: true,
                            backgroundColor: 'rgba(102, 126, 234, 0.1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            const expenseCtx = document.getElementById('expenseChart');
            if (expenseCtx) {
                expenseChart = new Chart(expenseCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Expenses',
                            data: financialData.monthly.expenseData,
                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        }

        function initFloatingChart() {
            const ctx = document.getElementById('floatingChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (floatingChart) {
                floatingChart.destroy();
                floatingChart = null;
            }

            const context = ctx.getContext('2d');
            const gradientFill = context.createLinearGradient(0, 0, 0, 150);
            gradientFill.addColorStop(0, 'rgba(147, 51, 234, 0.3)');
            gradientFill.addColorStop(1, 'rgba(147, 51, 234, 0.0)');

            const gradientLine = context.createLinearGradient(0, 0, 400, 0);
            gradientLine.addColorStop(0, 'rgba(236, 72, 153, 1)');
            gradientLine.addColorStop(1, 'rgba(67, 56, 202, 1)');

            floatingChart = new Chart(context, {
                type: 'line',
                data: {
                    labels: floatingChartData.monthly.labels,
                    datasets: [{
                        data: floatingChartData.monthly.values,
                        fill: true,
                        backgroundColor: gradientFill,
                        borderColor: gradientLine,
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        function updateFloatingChart(period) {
            const data = floatingChartData[period];

            ['daily', 'weekly', 'monthly'].forEach(p => {
                const btn = document.getElementById(p + 'BtnFloat');
                if (btn) {
                    btn.className = `group px-5 py-2.5 text-sm rounded-xl bg-gradient-to-r ${p === period ? 'from-white/20 to-blue-500/20' : 'from-white/10 to-blue-500/10 hover:from-white/20 hover:to-blue-500/20'
                        } text-white transition-all duration-300 hover:shadow-lg hover:scale-105`;
                }
            });

            if (floatingChart) {
                floatingChart.data.labels = data.labels;
                floatingChart.data.datasets[0].data = data.values;
                floatingChart.update('none');
            }

            const growthElement = document.getElementById('floatingGrowth');
            if (growthElement) growthElement.textContent = `+${data.growth}%`;

            const periodLabelElement = document.getElementById('periodLabel');
            if (periodLabelElement) periodLabelElement.textContent = `${period.charAt(0).toUpperCase() + period.slice(1)} Revenue`;

            const overviewRevenueElement = document.getElementById('overviewRevenue');
            if (overviewRevenueElement) {
                if (data.revenue >= 10000000) {
                    overviewRevenueElement.textContent = `‚Çπ${(data.revenue / 10000000).toFixed(2)}Cr`;
                } else if (data.revenue >= 100000) {
                    overviewRevenueElement.textContent = `‚Çπ${(data.revenue / 100000).toFixed(1)}L`;
                } else {
                    overviewRevenueElement.textContent = formatINR(data.revenue);
                }
            }

            const overviewRateElement = document.getElementById('overviewRate');
            if (overviewRateElement) overviewRateElement.textContent = `${data.rate}%`;
        }

        function changePeriod(period) {
            currentPeriod = period;
            updateMetrics(period);
            updateCharts(period);

            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('bg-gray-100');
            });
            document.querySelector(`[data-period="${period}"]`)?.classList.add('bg-gray-100');
        }

        function updateMetrics(period) {
            const data = financialData[period];
            document.getElementById('totalRevenue').textContent = formatINR(data.revenue);
            document.getElementById('outstandingInvoices').textContent = formatINR(data.outstandingInvoices);
            document.getElementById('monthlyExpenses').textContent = formatINR(data.monthlyExpenses);
            document.getElementById('netProfit').textContent = formatINR(data.netProfit);
        }

        function updateCharts(period) {
            const data = financialData[period];
            const labels = period === 'daily' ? ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] :
                period === 'weekly' ? ['Week 1', 'Week 2', 'Week 3', 'Week 4'] :
                    ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];

            if (revenueChart) {
                revenueChart.data.labels = labels;
                revenueChart.data.datasets[0].data = data.revenueData;
                revenueChart.update();
            }

            if (expenseChart) {
                expenseChart.data.labels = labels;
                expenseChart.data.datasets[0].data = data.expenseData;
                expenseChart.update();
            }
        }

        function updateFinancialMetrics() {
            // Calculate metrics from actual data
            const totalRevenue = invoicesData
                .filter(inv => inv.status === 'Paid')
                .reduce((sum, inv) => sum + (inv.totalAmount || inv.grandTotal || inv.amount || 0), 0);

            const outstandingInvoices = invoicesData
                .filter(inv => inv.status !== 'Paid')
                .reduce((sum, inv) => sum + (inv.totalAmount || inv.grandTotal || inv.amount || 0), 0);

            const pendingInvoiceCount = invoicesData.filter(inv => inv.status !== 'Paid').length;

            // Update display
            financialData[currentPeriod].revenue = totalRevenue;
            financialData[currentPeriod].outstandingInvoices = outstandingInvoices;

            updateMetrics(currentPeriod);

            document.getElementById('pendingCount').textContent = `${pendingInvoiceCount} pending payments`;

            // Update floating chart data
            floatingChartData[currentPeriod].revenue = totalRevenue;
            floatingChartData[currentPeriod].rate = totalRevenue > 0 ?
                Math.round((totalRevenue / (totalRevenue + outstandingInvoices)) * 100) : 0;
        }

        // UI Functions
        function renderInvoiceTable() {
            const tableBody = document.getElementById('invoiceTableBody');
            if (!tableBody) return;

            tableBody.innerHTML = '';

            if (invoicesData.length === 0) {
                tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="py-8 text-center text-gray-500">
                    No invoices found. Create your first invoice!
                </td>
            </tr>
        `;
                return;
            }

            invoicesData.forEach(invoice => {
                const statusClass = invoice.status === 'Paid' ? 'invoice-status-paid' :
                    invoice.status === 'Pending' ? 'invoice-status-pending' :
                        'invoice-status-overdue';

                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                row.innerHTML = `
            <td class="py-3 px-4 font-medium">${invoice.invoiceNumber || 'N/A'}</td>
            <td class="py-3 px-4">${invoice.clientName || 'N/A'}</td>
            <td class="py-3 px-4 font-semibold">${formatINR(invoice.totalAmount || invoice.grandTotal || invoice.amount || 0)}</td>
            <td class="py-3 px-4">
                <select class="status-dropdown ${statusClass}" onchange="changeInvoiceStatus('${invoice.id}', this.value)">
                    <option value="Paid" ${invoice.status === 'Paid' ? 'selected' : ''}>Paid</option>
                    <option value="Pending" ${invoice.status === 'Pending' ? 'selected' : ''}>Pending</option>
                    <option value="Overdue" ${invoice.status === 'Overdue' ? 'selected' : ''}>Overdue</option>
                </select>
                <span class="status-readonly hidden px-2 py-1 rounded text-xs font-medium ${statusClass}">${invoice.status}</span>
            </td>
            <td class="py-3 px-4 text-gray-600">${invoice.date ? new Date(invoice.date).toLocaleDateString('en-IN') : 'N/A'}</td>
            <td class="py-3 px-4">
                <div class="flex space-x-2">
                    <button onclick="editInvoice('${invoice.id}')" class="invoice-edit-btn px-2 py-1 bg-blue-100 text-blue-700 rounded" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="printInvoice('${invoice.id}')" class="px-2 py-1 bg-green-100 text-green-700 rounded" title="Print">
                        <i class="fas fa-print"></i>
                    </button>
                    <button onclick="deleteInvoice('${invoice.id}')" class="invoice-delete-btn px-2 py-1 bg-red-100 text-red-700 rounded" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
                tableBody.appendChild(row);
            });
            
            // Apply role-based restrictions after rendering
            setTimeout(() => applyRoleBasedRestrictions(), 10);
        }

        function renderTable(tab) {
            const tableBody = document.getElementById("transactionTable");
            if (!tableBody) return;

            tableBody.innerHTML = "";
            const transactions = accountsData[tab] || [];

            if (transactions.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                            No transactions found for ${tab}
                        </td>
                    </tr>
                `;
                return;
            }

            transactions.forEach(transaction => {
                const row = document.createElement("tr");
                row.className = "border-b border-gray-100 hover:bg-gray-50";
                row.innerHTML = `
                    <td class="px-6 py-4 text-gray-700">${new Date(transaction.date).toLocaleDateString('en-IN')}</td>
                    <td class="px-6 py-4 font-medium text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 text-gray-600">${transaction.notes || '-'}</td>
                    <td class="px-6 py-4 text-right font-semibold ${transaction.amount >= 0 ? 'text-green-600' : 'text-red-600'}">
                        ${formatINR(Math.abs(transaction.amount))} ${transaction.amount >= 0 ? '(Credit)' : '(Debit)'}
                    </td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex justify-center space-x-2">
                            <button onclick="editTransaction('${transaction.id}')" class="transaction-edit-btn px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransaction('${transaction.id}')" class="transaction-delete-btn px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
            
            // Apply role-based restrictions after rendering
            setTimeout(() => applyRoleBasedRestrictions(), 10);
        }

        function renderUserList() {
            const userList = document.getElementById('userList');
            if (!userList) return;

            userList.innerHTML = '';

            if (users.length === 0) {
                userList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-2xl mb-2"></i>
                        <p>No users found</p>
                    </div>
                `;
                return;
            }

            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                
                // Determine actions and button HTML based on user status
                let actionHtml = '';
                if (user.status === 'pending') {
                    actionHtml = `
                        <div class="relative inline-block text-left mr-2">
                            <select class="role-select block w-full rounded-md border-gray-300 shadow-sm focus:border-indigo-300 focus:ring focus:ring-indigo-200 focus:ring-opacity-50 text-sm py-1">
                                <option value="User">User</option>
                                <option value="Manager">Manager</option>
                                <option value="Admin">Admin</option>
                            </select>
                        </div>
                        <button onclick="approveUser('${user.id}')" class="text-xs bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded">Approve</button>
                        <button onclick="rejectUser('${user.id}')" class="text-xs bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">Reject</button>
                    `;
                } else if (user.status === 'approved') {
                    actionHtml = `
                        <span class="text-xs font-medium px-2 py-1 rounded bg-blue-100 text-blue-800">${user.role}</span>
                        <button onclick="revokeUser('${user.id}')" class="text-xs bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">Revoke</button>
                    `;
                } else if (user.status === 'rejected') {
                    actionHtml = `
                        <span class="text-xs font-medium px-2 py-1 rounded bg-red-100 text-red-800">Rejected</span>
                        <button onclick="approveUser('${user.id}')" class="text-xs bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded">Restore</button>
                    `;
                }

                userDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                            ${user.name ? user.name.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase()}
                        </div>
                        <div class="ml-3">
                            <div class="text-sm font-medium text-gray-900">${user.name || user.email}</div>
                            <div class="text-sm text-gray-500">${user.email}</div>
                        </div>
                        <div class="ml-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${user.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                        user.status === 'approved' ? 'bg-green-100 text-green-800' :
                            'bg-red-100 text-red-800'
                    }">
                                ${user.status.charAt(0).toUpperCase() + user.status.slice(1)}
                            </span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        ${actionHtml}
                    </div>
                `;
                userList.appendChild(userDiv);
            });
        }
        
        async function approveUser(userId) {
            try {
                const userDocRef = window.firestoreDoc(window.firestoreDb, "users", userId);
                // Find the role select for this user
                const roleSelect = document.querySelector(`button[onclick="approveUser('${userId}')"]`).parentElement.querySelector('.role-select');
                const newRole = roleSelect ? roleSelect.value : 'User'; // Default to User if dropdown not found

                await window.firestoreUpdateDoc(userDocRef, { 
                    status: "approved", 
                    role: newRole,
                    approvedAt: new Date()
                });
                showNotification(`‚úÖ User approved with role: ${newRole}`, 'success');
                loadUsers(); // Reload the list
            } catch (e) {
                console.error("‚ùå Error approving user:", e);
                showNotification('Failed to approve user', 'error');
            }
        }

        async function rejectUser(userId) {
            try {
                // Delete the user document completely when rejected
                await window.firestoreDeleteDoc(window.firestoreDoc(window.firestoreDb, "users", userId));
                showNotification('‚ùå User rejected and removed from system', 'success');
                loadUsers(); // Reload the list
            } catch (e) {
                console.error("‚ùå Error rejecting user:", e);
                showNotification('Failed to reject user', 'error');
            }
        }
        
        async function revokeUser(userId) {
            try {
                // Delete the user row from the display and database
                await window.firestoreDeleteDoc(window.firestoreDoc(window.firestoreDb, "users", userId));
                
                // Force logout if the revoked user is currently logged in
                // This is a client-side check - in a real app you'd want server-side session invalidation
                if (currentUser && currentUser.uid) {
                    // Check if we're revoking the current user
                    const userToRevoke = users.find(u => u.id === userId);
                    if (userToRevoke && userToRevoke.uid === currentUser.uid) {
                        // Log out the current user
                        await logout();
                        showNotification('üö´ Your access has been revoked by an administrator', 'error');
                        return;
                    }
                }
                
                showNotification('üö´ User access revoked and removed from system', 'success');
                loadUsers(); // Reload the list
            } catch (e) {
                console.error("‚ùå Error revoking user access:", e);
                showNotification('Failed to revoke user access', 'error');
            }
        }

        // Chart Functions
        function initCharts() {
            // Destroy existing charts if they exist
            if (revenueChart) {
                revenueChart.destroy();
                revenueChart = null;
            }
            if (expenseChart) {
                expenseChart.destroy();
                expenseChart = null;
            }

            const revenueCtx = document.getElementById('revenueChart');
            if (revenueCtx) {
                revenueChart = new Chart(revenueCtx, {
                    type: 'line',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Revenue',
                            data: financialData.monthly.revenueData,
                            borderColor: '#667eea',
                            tension: 0.3,
                            fill: true,
                            backgroundColor: 'rgba(102, 126, 234, 0.1)'
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }

            const expenseCtx = document.getElementById('expenseChart');
            if (expenseCtx) {
                expenseChart = new Chart(expenseCtx, {
                    type: 'bar',
                    data: {
                        labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
                        datasets: [{
                            label: 'Expenses',
                            data: financialData.monthly.expenseData,
                            backgroundColor: 'rgba(239, 68, 68, 0.5)',
                            borderColor: 'rgba(239, 68, 68, 1)',
                            borderWidth: 1
                        }]
                    },
                    options: {
                        responsive: true,
                        maintainAspectRatio: false,
                        plugins: {
                            legend: { display: false }
                        }
                    }
                });
            }
        }

        function initFloatingChart() {
            const ctx = document.getElementById('floatingChart');
            if (!ctx) return;

            // Destroy existing chart if it exists
            if (floatingChart) {
                floatingChart.destroy();
                floatingChart = null;
            }

            const context = ctx.getContext('2d');
            const gradientFill = context.createLinearGradient(0, 0, 0, 150);
            gradientFill.addColorStop(0, 'rgba(147, 51, 234, 0.3)');
            gradientFill.addColorStop(1, 'rgba(147, 51, 234, 0.0)');

            const gradientLine = context.createLinearGradient(0, 0, 400, 0);
            gradientLine.addColorStop(0, 'rgba(236, 72, 153, 1)');
            gradientLine.addColorStop(1, 'rgba(67, 56, 202, 1)');

            floatingChart = new Chart(context, {
                type: 'line',
                data: {
                    labels: floatingChartData.monthly.labels,
                    datasets: [{
                        data: floatingChartData.monthly.values,
                        fill: true,
                        backgroundColor: gradientFill,
                        borderColor: gradientLine,
                        borderWidth: 2,
                        pointRadius: 0,
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { display: false },
                        tooltip: { enabled: false }
                    },
                    scales: {
                        x: { display: false },
                        y: { display: false }
                    }
                }
            });
        }

        function updateFloatingChart(period) {
            const data = floatingChartData[period];

            ['daily', 'weekly', 'monthly'].forEach(p => {
                const btn = document.getElementById(p + 'BtnFloat');
                if (btn) {
                    btn.className = `group px-5 py-2.5 text-sm rounded-xl bg-gradient-to-r ${p === period ? 'from-white/20 to-blue-500/20' : 'from-white/10 to-blue-500/10 hover:from-white/20 hover:to-blue-500/20'
                        } text-white transition-all duration-300 hover:shadow-lg hover:scale-105`;
                }
            });

            if (floatingChart) {
                floatingChart.data.labels = data.labels;
                floatingChart.data.datasets[0].data = data.values;
                floatingChart.update('none');
            }

            const growthElement = document.getElementById('floatingGrowth');
            if (growthElement) growthElement.textContent = `+${data.growth}%`;

            const periodLabelElement = document.getElementById('periodLabel');
            if (periodLabelElement) periodLabelElement.textContent = `${period.charAt(0).toUpperCase() + period.slice(1)} Revenue`;

            const overviewRevenueElement = document.getElementById('overviewRevenue');
            if (overviewRevenueElement) {
                if (data.revenue >= 10000000) {
                    overviewRevenueElement.textContent = `‚Çπ${(data.revenue / 10000000).toFixed(2)}Cr`;
                } else if (data.revenue >= 100000) {
                    overviewRevenueElement.textContent = `‚Çπ${(data.revenue / 100000).toFixed(1)}L`;
                } else {
                    overviewRevenueElement.textContent = formatINR(data.revenue);
                }
            }

            const overviewRateElement = document.getElementById('overviewRate');
            if (overviewRateElement) overviewRateElement.textContent = `${data.rate}%`;
        }

        function changePeriod(period) {
            currentPeriod = period;
            updateMetrics(period);
            updateCharts(period);

            document.querySelectorAll('.period-btn').forEach(btn => {
                btn.classList.remove('bg-gray-100');
            });
            document.querySelector(`[data-period="${period}"]`)?.classList.add('bg-gray-100');
        }

        function updateMetrics(period) {
            const data = financialData[period];
            document.getElementById('totalRevenue').textContent = formatINR(data.revenue);
            document.getElementById('outstandingInvoices').textContent = formatINR(data.outstandingInvoices);
            document.getElementById('monthlyExpenses').textContent = formatINR(data.monthlyExpenses);
            document.getElementById('netProfit').textContent = formatINR(data.netProfit);
        }

        function updateCharts(period) {
            const data = financialData[period];
            const labels = period === 'daily' ? ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'] :
                period === 'weekly' ? ['Week 1', 'Week 2', 'Week 3', 'Week 4'] :
                    ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'];

            if (revenueChart) {
                revenueChart.data.labels = labels;
                revenueChart.data.datasets[0].data = data.revenueData;
                revenueChart.update();
            }

            if (expenseChart) {
                expenseChart.data.labels = labels;
                expenseChart.data.datasets[0].data = data.expenseData;
                expenseChart.update();
            }
        }

        function updateFinancialMetrics() {
            // Calculate metrics from actual data
            const totalRevenue = invoicesData
                .filter(inv => inv.status === 'Paid')
                .reduce((sum, inv) => sum + (inv.totalAmount || inv.grandTotal || inv.amount || 0), 0);

            const outstandingInvoices = invoicesData
                .filter(inv => inv.status !== 'Paid')
                .reduce((sum, inv) => sum + (inv.totalAmount || inv.grandTotal || inv.amount || 0), 0);

            const pendingInvoiceCount = invoicesData.filter(inv => inv.status !== 'Paid').length;

            // Update display
            financialData[currentPeriod].revenue = totalRevenue;
            financialData[currentPeriod].outstandingInvoices = outstandingInvoices;

            updateMetrics(currentPeriod);

            document.getElementById('pendingCount').textContent = `${pendingInvoiceCount} pending payments`;

            // Update floating chart data
            floatingChartData[currentPeriod].revenue = totalRevenue;
            floatingChartData[currentPeriod].rate = totalRevenue > 0 ?
                Math.round((totalRevenue / (totalRevenue + outstandingInvoices)) * 100) : 0;
        }

        // UI Functions
        function renderInvoiceTable() {
            const tableBody = document.getElementById('invoiceTableBody');
            if (!tableBody) return;

            tableBody.innerHTML = '';

            if (invoicesData.length === 0) {
                tableBody.innerHTML = `
            <tr>
                <td colspan="6" class="py-8 text-center text-gray-500">
                    No invoices found. Create your first invoice!
                </td>
            </tr>
        `;
                return;
            }

            invoicesData.forEach(invoice => {
                const statusClass = invoice.status === 'Paid' ? 'invoice-status-paid' :
                    invoice.status === 'Pending' ? 'invoice-status-pending' :
                        'invoice-status-overdue';

                const row = document.createElement('tr');
                row.className = 'border-b border-gray-100 hover:bg-gray-50';
                row.innerHTML = `
            <td class="py-3 px-4 font-medium">${invoice.invoiceNumber || 'N/A'}</td>
            <td class="py-3 px-4">${invoice.clientName || 'N/A'}</td>
            <td class="py-3 px-4 font-semibold">${formatINR(invoice.totalAmount || invoice.grandTotal || invoice.amount || 0)}</td>
            <td class="py-3 px-4">
                <select class="status-dropdown ${statusClass}" onchange="changeInvoiceStatus('${invoice.id}', this.value)">
                    <option value="Paid" ${invoice.status === 'Paid' ? 'selected' : ''}>Paid</option>
                    <option value="Pending" ${invoice.status === 'Pending' ? 'selected' : ''}>Pending</option>
                    <option value="Overdue" ${invoice.status === 'Overdue' ? 'selected' : ''}>Overdue</option>
                </select>
            </td>
            <td class="py-3 px-4 text-gray-600">${invoice.date ? new Date(invoice.date).toLocaleDateString('en-IN') : 'N/A'}</td>
            <td class="py-3 px-4">
                <div class="flex space-x-2">
                    <button onclick="editInvoice('${invoice.id}')" class="px-2 py-1 bg-blue-100 text-blue-700 rounded" title="Edit">
                        <i class="fas fa-edit"></i>
                    </button>
                    <button onclick="printInvoice('${invoice.id}')" class="px-2 py-1 bg-green-100 text-green-700 rounded" title="Print">
                        <i class="fas fa-print"></i>
                    </button>
                    <button onclick="deleteInvoice('${invoice.id}')" class="px-2 py-1 bg-red-100 text-red-700 rounded" title="Delete">
                        <i class="fas fa-trash"></i>
                    </button>
                </div>
            </td>
        `;
                tableBody.appendChild(row);
            });
        }

        function renderTable(tab) {
            const tableBody = document.getElementById("transactionTable");
            if (!tableBody) return;

            tableBody.innerHTML = "";
            const transactions = accountsData[tab] || [];

            if (transactions.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="px-6 py-8 text-center text-gray-500">
                            No transactions found for ${tab}
                        </td>
                    </tr>
                `;
                return;
            }

            transactions.forEach(transaction => {
                const row = document.createElement("tr");
                row.className = "border-b border-gray-100 hover:bg-gray-50";
                row.innerHTML = `
                    <td class="px-6 py-4 text-gray-700">${new Date(transaction.date).toLocaleDateString('en-IN')}</td>
                    <td class="px-6 py-4 font-medium text-gray-900">${transaction.description}</td>
                    <td class="px-6 py-4 text-gray-600">${transaction.notes || '-'}</td>
                    <td class="px-6 py-4 text-right font-semibold ${transaction.amount >= 0 ? 'text-green-600' : 'text-red-600'}">
                        ${formatINR(Math.abs(transaction.amount))} ${transaction.amount >= 0 ? '(Credit)' : '(Debit)'}
                    </td>
                    <td class="px-6 py-4 text-center">
                        <div class="flex justify-center space-x-2">
                            <button onclick="editTransaction('${transaction.id}')" class="px-2 py-1 bg-blue-100 text-blue-700 rounded hover:bg-blue-200 transition-colors">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button onclick="deleteTransaction('${transaction.id}')" class="px-2 py-1 bg-red-100 text-red-700 rounded hover:bg-red-200 transition-colors">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        // This is the function I am replacing below.
        function renderUserList() {
            const userList = document.getElementById('userList');
            if (!userList) return;

            userList.innerHTML = '';

            if (users.length === 0) {
                userList.innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-users text-2xl mb-2"></i>
                        <p>No users found</p>
                    </div>
                `;
                return;
            }

            users.forEach(user => {
                const userDiv = document.createElement('div');
                userDiv.className = 'flex items-center justify-between p-3 bg-gray-50 rounded-lg';
                userDiv.innerHTML = `
                    <div class="flex items-center">
                        <div class="w-8 h-8 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full flex items-center justify-center text-white font-semibold text-sm">
                            ${user.name ? user.name.charAt(0).toUpperCase() : user.email.charAt(0).toUpperCase()}
                        </div>
                        <div class="ml-3">
                            <div class="text-sm font-medium text-gray-900">${user.name || user.email}</div>
                            <div class="text-sm text-gray-500">${user.email}</div>
                        </div>
                        <div class="ml-4">
                            <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${user.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                        user.status === 'approved' ? 'bg-green-100 text-green-800' :
                            'bg-red-100 text-red-800'
                    }">
                                ${user.status.charAt(0).toUpperCase() + user.status.slice(1)}
                            </span>
                        </div>
                    </div>
                    <div class="flex space-x-2">
                        ${user.status === 'pending' ? `
                            <button onclick="updateUserStatus('${user.id}', 'approved')" class="text-xs bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded">
                                Approve
                            </button>
                            <button onclick="updateUserStatus('${user.id}', 'rejected')" class="text-xs bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">
                                Reject
                            </button>
                        ` : user.status === 'approved' ? `
                            <button onclick="updateUserStatus('${user.id}', 'rejected')" class="text-xs bg-red-500 hover:bg-red-600 text-white px-2 py-1 rounded">
                                Revoke
                            </button>
                        ` : `
                            <button onclick="updateUserStatus('${user.id}', 'approved')" class="text-xs bg-green-500 hover:bg-green-600 text-white px-2 py-1 rounded">
                                Restore
                            </button>
                        `}
                    </div>
                `;
                userList.appendChild(userDiv);
            });
        }

        // Modal Functions
        async function openInvoiceModal(invoiceId = null) {
            const modal = document.getElementById('invoiceModal');
            const modalTitle = document.getElementById('invoiceModalTitle');
            const submitBtn = document.getElementById('invoiceSubmitBtn');

            currentEditingInvoiceId = invoiceId;

            if (invoiceId) {
                modalTitle.textContent = 'Edit Invoice';
                submitBtn.textContent = 'Update Invoice';
                populateInvoiceForm(invoiceId);
            } else {
                modalTitle.textContent = 'Create New Invoice';
                submitBtn.textContent = 'Create Invoice';
                resetInvoiceForm();
                
                // Generate invoice number automatically
                const invoiceNumber = await generateInvoiceNumber('INVOICE');
                document.getElementById('invoiceNumber').value = invoiceNumber;
            }

            modal.classList.remove('hidden');
        }

        function closeInvoiceModal() {
            const modal = document.getElementById('invoiceModal');
            modal.classList.add('hidden');
            currentEditingInvoiceId = null;
            resetInvoiceForm();
        }

        function resetInvoiceForm() {
            document.getElementById('invoiceForm').reset();
            
            // Reset package selection
            const packageSelect = document.getElementById('packageSelect');
            if (packageSelect) packageSelect.value = '';
            
            // Reset quantity to 1
            const quantityEl = document.getElementById('quantity');
            if (quantityEl) quantityEl.value = '1';
            
            // Clear rate and amount
            const rateEl = document.getElementById('rate');
            if (rateEl) rateEl.value = '';
            
            const amountEl = document.getElementById('amount');
            if (amountEl) amountEl.value = '';
            
            // Clear total amount
            const totalAmountEl = document.getElementById('totalAmount');
            if (totalAmountEl) totalAmountEl.textContent = '0';
            
            // Set today's date as default
            const invoiceDateEl = document.getElementById('invoiceDate');
            if (invoiceDateEl) invoiceDateEl.value = new Date().toISOString().split('T')[0];
            
            // Uncheck paid stamp
            const paidStampEl = document.getElementById('paidStamp');
            if (paidStampEl) paidStampEl.checked = false;
        }

        // New functions for custom invoice template
        function updatePackageRate() {
            const packageSelect = document.getElementById('packageSelect');
            const rateEl = document.getElementById('rate');
            
            console.log('updatePackageRate called');
            console.log('Package select value:', packageSelect?.value);
            
            if (packageSelect && rateEl) {
                const selectedOption = packageSelect.options[packageSelect.selectedIndex];
                console.log('Selected option:', selectedOption?.text, 'Rate:', selectedOption?.dataset?.rate);
                
                if (selectedOption && selectedOption.dataset.rate) {
                    rateEl.value = selectedOption.dataset.rate;
                    console.log('Rate updated to:', rateEl.value);
                    calculateTotal();
                } else {
                    console.log('No rate found for selected option');
                }
            } else {
                console.log('Missing elements:', {
                    packageSelect: !!packageSelect,
                    rateEl: !!rateEl
                });
            }
        }
        
        function calculateTotal() {
            const quantityEl = document.getElementById('quantity');
            const rateEl = document.getElementById('rate');
            const amountEl = document.getElementById('amount');
            const totalAmountEl = document.getElementById('totalAmount');
            
            console.log('calculateTotal called');
            console.log('Elements found:', {
                quantity: quantityEl?.value,
                rate: rateEl?.value,
                amount: amountEl?.value,
                totalAmount: totalAmountEl?.textContent
            });
            
            if (quantityEl && rateEl && amountEl && totalAmountEl) {
                const quantity = parseFloat(quantityEl.value) || 0;
                const rate = parseFloat(rateEl.value) || 0;
                const amount = quantity * rate;
                
                console.log('Calculated:', { quantity, rate, amount });
                
                amountEl.value = amount.toFixed(2);
                totalAmountEl.textContent = amount.toFixed(0);
                
                console.log('Updated elements:', {
                    amountField: amountEl.value,
                    totalDisplay: totalAmountEl.textContent
                });
            } else {
                console.log('Missing elements:', {
                    quantityEl: !!quantityEl,
                    rateEl: !!rateEl, 
                    amountEl: !!amountEl,
                    totalAmountEl: !!totalAmountEl
                });
            }
        }

        function addInvoiceItem() {
            const itemsContainer = document.getElementById('invoiceItems');
            const itemDiv = document.createElement('div');
            itemDiv.className = 'p-4 border border-gray-300 rounded-lg invoice-item';

            itemDiv.innerHTML = `
                <div class="flex justify-between items-center mb-4">
                    <h5 class="font-medium text-gray-900">Item ${itemsContainer.children.length + 1}</h5>
                    <button type="button" onclick="removeInvoiceItem(this)" class="text-red-600 hover:text-red-800">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4">
                    <div class="md:col-span-2">
                        <label class="block text-sm font-medium text-gray-700 mb-1">Description of Goods</label>
                        <input type="text" name="description" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">HSN/SAC Code</label>
                        <input type="text" name="hsnCode" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Packets</label>
                        <input type="text" name="packets" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Qty</label>
                        <input type="number" name="quantity" value="1.000" min="0.001" step="0.001" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500" onchange="calculateItemAmount(this)" required>
                    </div>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4 mt-4">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Unit</label>
                        <select name="unit" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500">
                            <option value="Pcs.">Pcs.</option>
                            <option value="Kg">Kg</option>
                            <option value="L">L</option>
                            <option value="Service">Service</option>
                            <option value="Hour">Hour</option>
                            <option value="Day">Day</option>
                            <option value="Month">Month</option>
                        </select>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">List Price (‚Çπ)</label>
                        <input type="number" name="listPrice" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500" onchange="calculateItemAmount(this)" required>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Discount</label>
                        <input type="number" name="discount" value="0.00" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-1 focus:ring-blue-500 focus:border-blue-500" onchange="calculateItemAmount(this)">
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Price</label>
                        <input type="number" name="price" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100" readonly>
                    </div>
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-1">Amount</label>
                        <input type="number" name="amount" step="0.01" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-100" readonly>
                    </div>
                </div>
            `;

            itemsContainer.appendChild(itemDiv);
        }

        function removeInvoiceItem(button) {
            const itemDiv = button.closest('.invoice-item');
            itemDiv.remove();
            calculateTotals();

            // Update item numbers
            const items = document.querySelectorAll('.invoice-item h5');
            items.forEach((item, index) => {
                item.textContent = `Item ${index + 1}`;
            });
        }

        function calculateItemAmount(input) {
            const itemDiv = input.closest('.invoice-item');
            const quantity = parseFloat(itemDiv.querySelector('[name="quantity"]').value) || 0;
            const listPrice = parseFloat(itemDiv.querySelector('[name="listPrice"]').value) || 0;
            const discount = parseFloat(itemDiv.querySelector('[name="discount"]').value) || 0;

            // Calculate price (list price minus discount per unit)
            const price = listPrice - (discount / quantity);
            const amount = quantity * price;

            // Update the price and amount fields
            itemDiv.querySelector('[name="price"]').value = price.toFixed(2);
            itemDiv.querySelector('[name="amount"]').value = amount.toFixed(2);

            calculateTotals();
        }

        // Function to toggle shipping address fields
        function toggleShippingAddress() {
            const sameAsInvoice = document.getElementById('sameAsInvoice').checked;
            const shippingSection = document.getElementById('shippingSection');
            
            if (sameAsInvoice) {
                // Copy invoice details to shipping
                document.getElementById('shippingName').value = document.getElementById('clientName').value;
                document.getElementById('shippingMobile').value = document.getElementById('clientMobile').value;
                document.getElementById('shippingGstin').value = document.getElementById('clientGstin').value;
                document.getElementById('shippingStatePin').value = document.getElementById('clientStatePin').value;
                document.getElementById('shippingAddress').value = document.getElementById('invoiceAddress').value;
                
                // Disable shipping fields
                shippingSection.querySelectorAll('input, textarea').forEach(field => {
                    field.disabled = true;
                    field.classList.add('bg-gray-100');
                });
            } else {
                // Enable shipping fields
                shippingSection.querySelectorAll('input, textarea').forEach(field => {
                    field.disabled = false;
                    field.classList.remove('bg-gray-100');
                });
            }
        }

        // Function to convert number to words (Indian format)
        function numberToWords(amount) {
            const ones = ['', 'One', 'Two', 'Three', 'Four', 'Five', 'Six', 'Seven', 'Eight', 'Nine', 'Ten', 'Eleven', 'Twelve', 'Thirteen', 'Fourteen', 'Fifteen', 'Sixteen', 'Seventeen', 'Eighteen', 'Nineteen'];
            const tens = ['', '', 'Twenty', 'Thirty', 'Forty', 'Fifty', 'Sixty', 'Seventy', 'Eighty', 'Ninety'];

            function convertBelow100(num) {
                if (num < 20) return ones[num];
                return tens[Math.floor(num / 10)] + (num % 10 !== 0 ? ' ' + ones[num % 10] : '');
            }

            function convertBelow1000(num) {
                if (num === 0) return '';
                if (num < 100) return convertBelow100(num);
                return ones[Math.floor(num / 100)] + ' Hundred' + (num % 100 !== 0 ? ' ' + convertBelow100(num % 100) : '');
            }

            if (amount === 0) return 'Zero Rupees Only';
            
            let crores = Math.floor(amount / 10000000);
            let lakhs = Math.floor((amount % 10000000) / 100000);
            let thousands = Math.floor((amount % 100000) / 1000);
            let hundreds = amount % 1000;
            
            let result = '';
            
            if (crores > 0) {
                result += convertBelow100(crores) + ' Crore ';
            }
            if (lakhs > 0) {
                result += convertBelow100(lakhs) + ' Lakh ';
            }
            if (thousands > 0) {
                result += convertBelow100(thousands) + ' Thousand ';
            }
            if (hundreds > 0) {
                result += convertBelow1000(hundreds) + ' ';
            }
            
            return result.trim() + ' Rupees Only';
        }

        function calculateTotals() {
            let subtotal = 0;
            document.querySelectorAll('.invoice-item').forEach(itemDiv => {
                const amount = parseFloat(itemDiv.querySelector('[name="amount"]').value) || 0;
                subtotal += amount;
            });

            // Get SGST and CGST rates (default 9% each)
            const sgstRate = 9.00;
            const cgstRate = 9.00;

            const sgstAmount = (subtotal * sgstRate) / 100;
            const cgstAmount = (subtotal * cgstRate) / 100;
            const grandTotal = subtotal + sgstAmount + cgstAmount;

            // Calculate amount to pay
            const amountReceived = parseFloat(document.getElementById('amountReceived').value) || 0;
            const amountToPay = grandTotal - amountReceived;

            // Update the totals section
            document.getElementById('subtotal').value = subtotal.toFixed(2);
            document.getElementById('sgstAmount').value = sgstAmount.toFixed(2);
            document.getElementById('cgstAmount').value = cgstAmount.toFixed(2);
            document.getElementById('grandTotal').value = grandTotal.toFixed(2);
            document.getElementById('amountToPay').value = amountToPay.toFixed(2);
            
            // Convert grand total to words
            document.getElementById('amountInWords').value = numberToWords(Math.floor(grandTotal));
        }

        function populateInvoiceForm(invoiceId) {
            const invoice = invoicesData.find(inv => inv.id === invoiceId);
            if (!invoice) return;

            // Populate basic invoice details
            document.getElementById('invoiceNumber').value = invoice.invoiceNumber || '';
            document.getElementById('invoiceDate').value = invoice.date || '';
            document.getElementById('clientName').value = invoice.clientName || '';
            document.getElementById('clientMobile').value = invoice.clientMobile || '';
            document.getElementById('clientEmail').value = invoice.clientEmail || '';
            document.getElementById('clientStatePin').value = invoice.clientStatePin || '';
            document.getElementById('invoiceAddress').value = invoice.invoiceAddress || '';
            
            // Populate package selection if available
            const packageSelect = document.getElementById('packageSelect');
            if (packageSelect && invoice.packageType) {
                packageSelect.value = invoice.packageType;
                updatePackageRate();
            }
            
            // Populate quantity
            const quantityEl = document.getElementById('quantity');
            if (quantityEl && invoice.quantity) {
                quantityEl.value = invoice.quantity;
            }
            
            // Populate paid stamp
            const paidStampEl = document.getElementById('paidStamp');
            if (paidStampEl && invoice.isPaid) {
                paidStampEl.checked = invoice.isPaid;
            }
            
            // Recalculate totals
            calculateTotal();
        }

        function switchTab(tab) {
            currentTab = tab;

            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('border-indigo-500', 'text-indigo-600');
                btn.classList.add('border-transparent', 'text-gray-600');
            });

            const activeBtn = document.querySelector(`[data-tab="${tab}"]`);
            if (activeBtn) {
                activeBtn.classList.remove('border-transparent', 'text-gray-600');
                activeBtn.classList.add('border-indigo-500', 'text-indigo-600');
            }

            renderTable(tab);
            
            // Apply role-based restrictions after rendering
            setTimeout(() => applyRoleBasedRestrictions(), 50);
        }

        function openModal(transactionId = null) {
            const modal = document.getElementById("modal");
            const modalTitle = document.getElementById("modal-title");
            const submitBtn = document.getElementById("submitBtn");

            currentEditingId = transactionId;

            if (transactionId) {
                modalTitle.textContent = "Edit Transaction";
                submitBtn.textContent = "Update";
                populateTransactionForm(transactionId);
            } else {
                modalTitle.textContent = "Add Transaction";
                submitBtn.textContent = "Add";
                resetTransactionForm();
            }

            modal.classList.remove("hidden");
        }

        function closeModal() {
            document.getElementById("modal").classList.add("hidden");
            currentEditingId = null;
            resetTransactionForm();
        }

        function resetTransactionForm() {
            document.getElementById("transactionForm").reset();
            document.getElementById('date').value = new Date().toISOString().split('T')[0];
        }

        function populateTransactionForm(transactionId) {
            const transaction = Object.values(accountsData).flat().find(t => t.id === transactionId);
            if (transaction) {
                document.getElementById("date").value = transaction.date || '';
                document.getElementById("description").value = transaction.description || '';
                document.getElementById("notes").value = transaction.notes || '';
                document.getElementById("amount").value = Math.abs(transaction.amount) || 0;
            }
        }

        // Action Functions
        function editInvoice(invoiceId) {
            openInvoiceModal(invoiceId);
        }

        async function deleteInvoice(invoiceId) {
            console.log('Delete invoice called for ID:', invoiceId);
            console.log('Current user role:', currentUser?.role);
            
            if (confirm('Are you sure you want to delete this invoice? This action cannot be undone.')) {
                let remoteDeleted = false;
                try {
                    console.log('Attempting to delete invoice...');
                    
                    // Remove from Firestore if connected
                    if (window.firestoreDb && window.firestoreDeleteDoc) {
                        console.log('Deleting from Firestore...');
                        await window.firestoreDeleteDoc(window.firestoreDoc(window.firestoreDb, "invoices", invoiceId));
                        console.log('Firestore deletion successful');
                        remoteDeleted = true;
                    }
                } catch (e) {
                    console.warn('Remote deletion failed, will persist local hide fallback.', e);
                }
                
                // Remove from local array regardless so UI updates now
                const invoiceIndex = invoicesData.findIndex(inv => inv.id === invoiceId);
                if (invoiceIndex !== -1) {
                    invoicesData.splice(invoiceIndex, 1);
                }
                
                // Persist deleted id locally to prevent reappearing after refresh
                try {
                    const deleted = JSON.parse(localStorage.getItem('deletedInvoices') || '[]');
                    if (!deleted.includes(invoiceId)) {
                        deleted.push(invoiceId);
                    }
                    // If remote deletion succeeded, also prune the ID so list stays clean
                    if (remoteDeleted) {
                        const pruned = deleted.filter(id => id !== invoiceId);
                        localStorage.setItem('deletedInvoices', JSON.stringify(pruned));
                    } else {
                        localStorage.setItem('deletedInvoices', JSON.stringify(deleted));
                    }
                } catch (err) {
                    console.warn('Failed to store deleted invoice id locally', err);
                }
                
                // Update UI
                renderInvoiceTable();
                updateFinancialMetrics();
                showNotification(remoteDeleted ? 'Invoice deleted successfully' : 'Invoice deleted locally (will not reappear on refresh)', remoteDeleted ? 'success' : 'info');
            } else {
                console.log('Delete cancelled by user');
            }
        }

        function changeInvoiceStatus(invoiceId, newStatus) {
            const invoice = invoicesData.find(inv => inv.id === invoiceId);
            if (invoice) {
                invoice.status = newStatus;
                invoice.isPaid = newStatus === 'Paid';
                window.firestoreUpdateDoc(
                    window.firestoreDoc(window.firestoreDb, "invoices", invoiceId),
                    { status: newStatus, isPaid: newStatus === 'Paid' }
                );
                updateFinancialMetrics();
                showNotification(`Invoice status changed to ${newStatus}`, 'success');
            }
        }

        function editTransaction(transactionId) {
            openModal(transactionId);
        }

        async function deleteTransaction(transactionId) {
            if (confirm("Are you sure you want to delete this transaction?")) {
                try {
                    await window.firestoreDeleteDoc(window.firestoreDoc(window.firestoreDb, "transactions", transactionId));
                    showNotification('Transaction deleted successfully', 'success');
                    loadTransactions();
                } catch (e) {
                    console.error("‚ùå Error deleting transaction:", e);
                    showNotification('Failed to delete transaction', 'error');
                }
            }
        }

        function printInvoice(invoiceId) {
            const invoice = invoicesData.find(inv => inv.id === invoiceId);
            if (!invoice) return;

            generateInvoiceTemplate(invoice);

            if (confirm('Would you like to download as PDF? Click OK for PDF, Cancel to print directly.')) {
                downloadInvoicePDF(invoice);
            } else {
                window.print();
            }
        }

        function generateInvoiceTemplate(invoice) {
            const printArea = document.getElementById('invoicePrintArea');

            // Calculate totals for new format (no tax)
            const totalAmount = invoice.totalAmount || invoice.amount || 0;
            
            // Create the invoice HTML matching invoice.jpg format exactly
            const invoiceHTML = `
        <div style="width: 210mm; margin: 20px auto; padding: 20px; font-family: Arial, sans-serif; font-size: 14px; color: #000; background: white;">
            
            <!-- Header Section -->
            <div style="display: flex; align-items: center; justify-content: space-between; margin-bottom: 30px; padding-bottom: 20px; border-bottom: 3px solid #4A90E2;">
                <div style="display: flex; align-items: center;">
                    <div style="margin-right: 18px; display:none; align-items:center;">
                        <img src="data:image/png;base64,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" alt="EnrollEngineer Logo" style="height: 32px; width: auto; display:block;"/>
                    </div>
                    <div>
                        <h1 style="font-size: 30px; font-weight: 800; letter-spacing: 1px; margin: 0; color: #111; text-transform: uppercase;">EnrollEngineer</h1>
                    </div>
                </div>
                <div style="text-align: right;">
                    <h2 style="font-size: 36px; font-weight: bold; margin: 0; color: #4A90E2;">INVOICE</h2>
                </div>
            </div>

            <!-- Invoice Details Section -->
            <div style="display: flex; justify-content: space-between; margin-bottom: 30px;">
                <div style="flex: 1;">
                    <div style="margin-bottom: 20px;">
                        <strong style="font-size: 16px;">Invoice to :</strong>
                        <h3 style="font-size: 20px; font-weight: bold; margin: 5px 0; color: #000;">${invoice.clientName || 'Client Name'}</h3>
                        <div style="font-size: 14px; line-height: 1.6; color: #333;">
                            <div><strong>Mob no. :</strong> ${invoice.clientMobile || '123-456-7890'}</div>
                            <div><strong>Email :</strong> ${invoice.clientEmail || 'hello@example.com'}</div>
                        </div>
                    </div>
                </div>
                <div style="text-align: right;">
                    <div><strong>Invoice no :</strong> ${invoice.invoiceNumber || 'INV/2025/001'}</div>
                    <div><strong>Billing Date:</strong> ${new Date(invoice.date).toLocaleDateString('en-GB') || new Date().toLocaleDateString('en-GB')}</div>
                </div>
            </div>

            <!-- Items Table -->
            <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px; border: 2px solid #4A90E2;">
                <thead>
                    <tr style="background: #4A90E2; color: white;">
                        <th style="border: 1px solid #4A90E2; padding: 12px; text-align: center; font-weight: bold;">NO</th>
                        <th style="border: 1px solid #4A90E2; padding: 12px; text-align: left; font-weight: bold;">DESCRIPTION</th>
                        <th style="border: 1px solid #4A90E2; padding: 12px; text-align: center; font-weight: bold;">QTY</th>
                        <th style="border: 1px solid #4A90E2; padding: 12px; text-align: center; font-weight: bold;">PRICE</th>
                        <th style="border: 1px solid #4A90E2; padding: 12px; text-align: center; font-weight: bold;">TOTAL</th>
                    </tr>
                </thead>
                <tbody>
                    <tr style="background: #E3F2FD;">
                        <td style="border: 1px solid #4A90E2; padding: 12px; text-align: center;">1</td>
                        <td style="border: 1px solid #4A90E2; padding: 12px;">${invoice.packageDescription || 'Standard Package'}</td>
                        <td style="border: 1px solid #4A90E2; padding: 12px; text-align: center;">${invoice.quantity || 1}</td>
                        <td style="border: 1px solid #4A90E2; padding: 12px; text-align: center;">‚Çπ${invoice.rate || 2000}</td>
                        <td style="border: 1px solid #4A90E2; padding: 12px; text-align: center;">‚Çπ${totalAmount}</td>
                    </tr>
                    <tr style="background: #F0F8FF;"><td colspan="5" style="border: 1px solid #4A90E2; padding: 12px;">&nbsp;</td></tr>
                    <tr style="background: #E3F2FD;"><td colspan="5" style="border: 1px solid #4A90E2; padding: 12px;">&nbsp;</td></tr>
                    <tr style="background: #F0F8FF;"><td colspan="5" style="border: 1px solid #4A90E2; padding: 12px;">&nbsp;</td></tr>
                    <tr style="background: #E3F2FD;"><td colspan="5" style="border: 1px solid #4A90E2; padding: 12px;">&nbsp;</td></tr>
                    <tr style="background: #F0F8FF;"><td colspan="5" style="border: 1px solid #4A90E2; padding: 12px;">&nbsp;</td></tr>
                    <tr style="background: #E3F2FD;"><td colspan="5" style="border: 1px solid #4A90E2; padding: 12px;">&nbsp;</td></tr>
                    <tr style="background: #F0F8FF;"><td colspan="5" style="border: 1px solid #4A90E2; padding: 12px;">&nbsp;</td></tr>
                    <tr style="background: #4A90E2; color: white;">
                        <td colspan="4" style="border: 1px solid #4A90E2; padding: 12px; text-align: right; font-weight: bold;">Sub Total :</td>
                        <td style="border: 1px solid #4A90E2; padding: 12px; text-align: center; font-weight: bold;">‚Çπ${totalAmount}</td>
                    </tr>
                </tbody>
            </table>

            <div style="text-align: right; margin-bottom: 30px;">
                <div style="font-size: 16px; margin-bottom: 10px;"><strong>Sub Total :</strong> <span style="margin-left: 50px;">‚Çπ${totalAmount}</span></div>
                <div style="background: #4A90E2; color: white; padding: 10px; display: inline-block; font-size: 18px; font-weight: bold;">
                    <strong>GRAND TOTAL :</strong> <span style="margin-left: 20px;">‚Çπ${totalAmount}</span>
                </div>
            </div>

            <!-- Payment Method -->
            <div style="margin-bottom: 30px;">
                <div style="background: #4A90E2; color: white; padding: 8px; font-size: 14px; font-weight: bold; display: inline-block;">
                    PAYMENT METHOD :
                </div>
                <div style="margin-top: 10px; display: flex; align-items: center;">
                    <img src="data:image/png;base64,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" alt="GPay" style="height: 28px;"/>
                    <span style="display:none; color:#5f6368; font-weight:600; font-size:20px; margin-left:8px;">G Pay</span>
                </div>
            </div>

            <!-- Footer -->
            <div style="border-top: 2px solid #ddd; padding-top: 20px; margin-top: 40px;">
                <div style="margin-bottom: 20px;">
                    <strong style="font-size: 16px;">Thank you for business with us!</strong>
                </div>
                
                <div style="display: flex; justify-content: space-between; align-items: flex-end;">
                    <div style="flex: 1;">
                        <div style="margin-bottom: 20px;">
                            <strong>Term and Conditions :</strong><br>
                            <div style="font-size: 12px; color: #666; line-height: 1.6; margin-top: 10px;">
                                For Registered & Paid Students, Upon<br>
                                Cancellation refund will be initiated only<br>
                                as per refund policy.
                            </div>
                        </div>
                        
                        <div style="display: flex; align-items: center; margin-top: 30px; padding-top: 20px; border-top: 1px solid #ddd;">
                            <div style="margin-right: 30px;">
                                <div style="display: flex; align-items: center; margin-bottom: 5px;">
                                    <span style="font-size: 14px; color: #4A90E2; margin-right: 5px;">üìû</span>
                                    <span style="font-size: 14px;">8446777225</span>
                                </div>
                            </div>
                            <div>
                                <div style="display: flex; align-items: center;">
                                    <span style="font-size: 14px; color: #4A90E2; margin-right: 5px;">‚úâÔ∏è</span>
                                    <span style="font-size: 14px;">enrollengineer24@gmail.com</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: right;">
                        ${invoice.isPaid ? `
                        <div style="margin-bottom: 10px; text-align: right;">
                            <img src="data:image/png;base64,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" alt="PAID" style="height: 85px;"/>
                        </div>
                        ` : ''}
                        <div style="margin-top: 10px; font-weight: bold;">EnrollEngineer</div>
                    </div>
                </div>
            </div>
        </div>
    `;

            printArea.innerHTML = invoiceHTML;
            printArea.classList.remove('hidden');
        }

        async function downloadInvoicePDF(invoice) {
            try {
                const { jsPDF } = window.jspdf;
                const printArea = document.getElementById('invoicePrintArea');

                // Ensure any images in the print area are fully loaded before rendering
                const imgs = Array.from(printArea.querySelectorAll('img'));
                await Promise.all(imgs.map(img => {
                    // Force anonymous CORS to help html2canvas
                    try { img.crossOrigin = 'anonymous'; } catch {}
                    if (img.decode) {
                        return img.decode().catch(() => Promise.resolve());
                    }
                    return new Promise(res => {
                        if (img.complete) return res();
                        img.addEventListener('load', res, { once: true });
                        img.addEventListener('error', () => res(), { once: true });
                    });
                }));

                const canvas = await html2canvas(printArea, {
                    scale: 2,
                    useCORS: true,
                    allowTaint: true,
                    backgroundColor: '#ffffff',
                    imageTimeout: 2000
                });

                const imgData = canvas.toDataURL('image/png');
                const pdf = new jsPDF('p', 'mm', 'a4');

                const pdfWidth = pdf.internal.pageSize.getWidth();
                const pdfHeight = pdf.internal.pageSize.getHeight();
                const imgWidth = canvas.width;
                const imgHeight = canvas.height;
                const ratio = Math.min(pdfWidth / imgWidth, pdfHeight / imgHeight);
                const imgX = (pdfWidth - imgWidth * ratio) / 2;
                const imgY = 0;

                pdf.addImage(imgData, 'PNG', imgX, imgY, imgWidth * ratio, imgHeight * ratio);
                const fileName = `Invoice-${invoice.invoiceNumber || invoice.orderNo || invoice.id || Date.now()}.pdf`;
                pdf.save(fileName);

                printArea.classList.add('hidden');
            } catch (err) {
                console.error('PDF generation failed. Falling back to browser print.', err);
                try { window.print(); } catch {}
            }
        }

        function exportToExcel() {
            try {
                if (invoicesData.length === 0) {
                    showNotification('No invoice data to export', 'error');
                    return;
                }

                const exportData = invoicesData.map(invoice => ({
                    'Invoice ID': invoice.id,
                    'Order No': invoice.orderNo || '',
                    'Date': invoice.date || '',
                    'Order ID': invoice.orderId || '',
                    'Due Date': invoice.dueDate || '',
                    'Client Name': invoice.clientName || '',
                    'Client GSTIN': invoice.clientGstin || '',
                    'Subtotal': invoice.subtotal || 0,
                    'SGST Rate': (invoice.sgstRate || 0) + '%',
                    'SGST Amount': invoice.sgstAmount || 0,
                    'CGST Rate': (invoice.cgstRate || 0) + '%',
                    'CGST Amount': invoice.cgstAmount || 0,
                    'Grand Total': invoice.grandTotal || 0,
                    'Status': invoice.status || 'Pending',
                    'Export Date': new Date().toLocaleDateString('en-IN')
                }));

                const ws = XLSX.utils.json_to_sheet(exportData);
                const wb = XLSX.utils.book_new();
                XLSX.utils.book_append_sheet(wb, ws, 'Invoices');

                const colWidths = [];
                const headers = Object.keys(exportData[0] || {});
                headers.forEach(header => {
                    const maxLength = Math.max(
                        header.length,
                        ...exportData.map(row => String(row[header] || '').length)
                    );
                    colWidths.push({ width: Math.min(maxLength + 2, 50) });
                });
                ws['!cols'] = colWidths;

                const timestamp = new Date().toISOString().split('T')[0];
                const filename = `FinanceFlow_Invoices_${timestamp}.xlsx`;

                XLSX.writeFile(wb, filename);
                showNotification('Invoice data exported successfully', 'success');

            } catch (error) {
                console.error('Failed to export to Excel:', error);
                showNotification('Failed to export invoice data', 'error');
            }
        }

        function exportAllData() {
            const allData = {
                invoices: invoicesData,
                accounts: accountsData,
                users: users.filter(u => u.id !== currentUser?.uid), // Don't export current user's data
                exportDate: new Date().toISOString(),
                exportedBy: currentUser?.email || 'Unknown'
            };

            const dataStr = JSON.stringify(allData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `financeflow-data-${new Date().toISOString().split('T')[0]}.json`;
            link.click();

            showNotification('All data exported successfully', 'success');
        }

        function refreshUsers() {
            loadUsers();
        }

        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = `fixed top-4 right-4 px-6 py-3 rounded-lg z-50 ${type === 'success' ? 'bg-green-500 text-white' : 'bg-red-500 text-white'
                }`;
            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Initialize everything when DOM is loaded
        document.addEventListener('DOMContentLoaded', () => {
            // Set up form event listeners
            document.getElementById('loginForm').addEventListener('submit', handleLogin);
            document.getElementById('signupForm').addEventListener('submit', handleSignup);
            document.getElementById('switchToSignupBtn').addEventListener('click', switchToSignup);
            document.getElementById('switchToLoginBtn').addEventListener('click', switchToLogin);

            // Set up invoice form
            const invoiceForm = document.getElementById('invoiceForm');
            invoiceForm.addEventListener('submit', async function (e) {
                e.preventDefault();
                
                console.log('üìù Invoice form submitted');
                
                try {
                    // Validate required fields for new simplified form
                    const invoiceDate = document.getElementById('invoiceDate').value;
                    const clientName = document.getElementById('clientName').value;
                    const clientMobile = document.getElementById('clientMobile').value;
                    const packageSelect = document.getElementById('packageSelect').value;
                    const quantity = document.getElementById('quantity').value;
                    
                    if (!invoiceDate) {
                        showNotification('Please select an invoice date', 'error');
                        return;
                    }
                    
                    if (!clientName) {
                        showNotification('Please enter client name', 'error');
                        return;
                    }
                    
                    if (!clientMobile) {
                        showNotification('Please enter client mobile number', 'error');
                        return;
                    }
                    
                    if (!packageSelect) {
                        showNotification('Please select a package', 'error');
                        return;
                    }
                    
                    if (!quantity || quantity <= 0) {
                        showNotification('Please enter a valid quantity', 'error');
                        return;
                    }
                    
                    // Get form data for simplified invoice
                    const rate = parseFloat(document.getElementById('rate').value) || 0;
                    const amount = parseFloat(document.getElementById('amount').value) || 0;
                    const isPaid = document.getElementById('paidStamp').checked;
                    
                    console.log('üìä Form values captured:', {
                        invoiceDate,
                        clientName,
                        packageSelect,
                        quantity,
                        rate,
                        amount,
                        isPaid
                    });
                    
                    // Ensure calculations are done before submission
                    updatePackageRate();
                    
                    // Recalculate after ensuring rate is set
                    const finalRate = parseFloat(document.getElementById('rate').value) || 0;
                    const finalAmount = parseFloat(document.getElementById('amount').value) || (parseInt(quantity) * finalRate);
                    
                    console.log('üîÑ Recalculated values:', {
                        finalRate,
                        finalAmount,
                        calculation: parseInt(quantity) + ' √ó ' + finalRate + ' = ' + (parseInt(quantity) * finalRate)
                    });
                    
                    // Get package description from select option
                    const packageSelectEl = document.getElementById('packageSelect');
                    const packageDescription = packageSelectEl.options[packageSelectEl.selectedIndex].text;
                    
                    console.log('üì¶ Package info:', {
                        packageType: packageSelect,
                        packageDescription
                    });
                    
                    const invoiceData = {
                        invoiceNumber: document.getElementById('invoiceNumber')?.value,
                        date: invoiceDate,
                        
                        // Company info (fixed)
                        companyName: 'EnrollEngineer',
                        companyPhone: '8446777225',
                        companyEmail: 'enrollengineer24@gmail.com',
                        
                        // Client details
                        clientName: clientName,
                        clientMobile: clientMobile,
                        clientEmail: document.getElementById('clientEmail')?.value || '',
                        clientStatePin: document.getElementById('clientStatePin')?.value || '',
                        invoiceAddress: document.getElementById('invoiceAddress')?.value || '',
                        
                        // Package/Item details
                        packageType: packageSelect,
                        packageDescription: packageDescription,
                        quantity: parseInt(quantity),
                        rate: finalRate,
                        amount: finalAmount,
                        totalAmount: finalAmount, // Same as amount for single item
                        
                        // Payment status
                        isPaid: isPaid,
                        status: isPaid ? 'Paid' : 'Pending',
                        
                        // Metadata
                        createdAt: new Date(),
                        createdBy: currentUser?.email || 'Unknown'
                    };

                    console.log('üöÄ Calling saveInvoice with data:', invoiceData);
                    await saveInvoice(invoiceData);
                    console.log('‚úÖ Invoice saved successfully');
                
            } catch (error) {
                console.error('‚ùå Error submitting invoice:', error);
                showNotification('Failed to create invoice: ' + error.message, 'error');
            }
        });

            // No longer needed - bill type dropdown was removed from custom template

            // Set up transaction form
            const transactionForm = document.getElementById("transactionForm");
            transactionForm.addEventListener("submit", function (e) {
                e.preventDefault();

                const formData = new FormData(this);
                const amount = parseFloat(formData.get("amount")) || 0;
                const adjustedAmount = ['Miscellaneous Income'].includes(currentTab) ? amount : -amount;

                const transactionData = {
                    date: formData.get("date"),
                    description: formData.get("description"),
                    notes: formData.get("notes"),
                    amount: adjustedAmount,
                    category: currentTab,
                    createdAt: new Date(),
                    createdBy: currentUser?.email || 'Unknown'
                };

                saveTransaction(transactionData);
            });

            // Set up modal event listeners for custom template
            // No need for addInvoiceItemBtn as it's removed in custom template

            document.getElementById('closeInvoiceModalBtn')?.addEventListener('click', closeInvoiceModal);
            document.getElementById('cancelInvoiceBtn')?.addEventListener('click', closeInvoiceModal);

            document.getElementById('closeModal')?.addEventListener('click', closeModal);
            document.getElementById('cancelModal')?.addEventListener('click', closeModal);
            document.getElementById('openModal').addEventListener('click', () => openModal());

            // GST Slab dropdown was removed from custom template - no longer needed

            // Set up tab switching
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.addEventListener('click', function () {
                    switchTab(this.dataset.tab);
                });
            });

            // Set up user avatar dropdown
            document.getElementById('userAvatar').addEventListener('click', toggleUserDropdown);

            // Close dropdown when clicking outside
            document.addEventListener('click', function (e) {
                if (!e.target.closest('#userAvatar') && !e.target.closest('#userDropdown')) {
                    document.getElementById('userDropdown').classList.add('hidden');
                }
            });

            // Smooth scrolling for navigation
            document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                anchor.addEventListener('click', function (e) {
                    e.preventDefault();
                    const target = document.querySelector(this.getAttribute('href'));
                    if (target) {
                        target.scrollIntoView({ behavior: 'smooth' });
                    }
                });
            });

            // Check authentication state
            window.onAuthStateChanged(window.firebaseAuth, async (user) => {
                if (user) {
                    try {
                        const userDoc = await window.firestoreGetDocs(
                            window.firestoreQuery(
                                window.firestoreCollection(window.firestoreDb, 'users'),
                                window.firestoreWhere('email', '==', user.email)
                            )
                        );

                        if (!userDoc.empty) {
                            const userData = userDoc.docs[0].data();
                            if (userData.status === 'approved') {
                                currentUser = { ...userData, uid: user.uid };
                                updateUserDisplay();
                                hideAuthModal();
                                initApp();
                            } else if (userData.status === 'pending') {
                                showPendingModal();
                            } else {
                                await window.signOut(window.firebaseAuth);
                                showAuthModal();
                                showNotification('Access denied. Contact administrator.', 'error');
                            }
                        } else {
                            await window.signOut(window.firebaseAuth);
                            showAuthModal();
                        }
                    } catch (error) {
                        console.error('Error checking user status:', error);
                        showAuthModal();
                    }
                } else {
                    showAuthModal();
                }
            });
        });

        // Initialize app function
        function initApp() {
            console.log('üöÄ Initializing FinanceFlow Pro...');

            // Initialize charts
            initFloatingChart();
            updateFloatingChart('monthly');
            initCharts();

            // Set initial period
            changePeriod('monthly');

            // Load initial data
            loadInvoices();
            loadTransactions();
            if (currentUser && currentUser.role === 'Admin') {
                loadUsers();
            }

            // Initialize first tab
            switchTab("Employee Payment");
            
            // Start real-time user status monitoring
            startUserStatusMonitoring();

            console.log('‚úÖ FinanceFlow Pro initialized successfully!');
        }
        
        // Real-time user status monitoring
        function startUserStatusMonitoring() {
            if (!currentUser) return;
            
            // Check user status every 30 seconds
            setInterval(async () => {
                try {
                    const userDoc = await window.firestoreGetDocs(
                        window.firestoreQuery(
                            window.firestoreCollection(window.firestoreDb, 'users'),
                            window.firestoreWhere('email', '==', currentUser.email)
                        )
                    );
                    
                    if (userDoc.empty) {
                        // User has been deleted - force logout
                        await logout();
                        showNotification('üö´ Your access has been revoked by an administrator', 'error');
                    } else {
                        const userData = userDoc.docs[0].data();
                        if (userData.status === 'rejected') {
                            // User has been rejected - force logout
                            await logout();
                            showNotification('üö´ Your access has been revoked by an administrator', 'error');
                        } else if (userData.role !== currentUser.role) {
                            // User role has changed - update and refresh
                            currentUser.role = userData.role;
                            updateUserDisplay();
                            showNotification(`‚ÑπÔ∏è Your role has been updated to ${userData.role}`, 'info');
                        }
                    }
                } catch (error) {
                    console.error('Error checking user status:', error);
                }
            }, 30000); // Check every 30 seconds
        }
        
        // Notification function
        function showNotification(message, type = 'info') {
            // Create notification element
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 max-w-sm p-4 rounded-lg shadow-lg z-50 transform transition-transform duration-300 translate-x-full ${
                type === 'success' ? 'bg-green-100 text-green-800 border border-green-200' :
                type === 'error' ? 'bg-red-100 text-red-800 border border-red-200' :
                type === 'info' ? 'bg-blue-100 text-blue-800 border border-blue-200' :
                'bg-gray-100 text-gray-800 border border-gray-200'
            }`;
            
            notification.innerHTML = `
                <div class="flex items-center justify-between">
                    <div class="flex items-center">
                        <i class="fas fa-${
                            type === 'success' ? 'check-circle' :
                            type === 'error' ? 'exclamation-circle' :
                            type === 'info' ? 'info-circle' : 'bell'
                        } mr-2"></i>
                        <span class="text-sm font-medium">${message}</span>
                    </div>
                    <button onclick="this.parentElement.parentElement.remove()" class="text-gray-400 hover:text-gray-600">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentElement) {
                        notification.remove();
                    }
                }, 300);
            }, 5000);
        }
    </script>
</body>

</html>
